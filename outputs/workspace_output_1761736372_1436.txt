      message: err.errors[key].message
    }));
  }
  
  // Mongoose cast errors
  if (err.name === 'CastError') {
    statusCode = 400;
    message = `Invalid ${err.path}: ${err.value}`;
  }
  
  // Send error response
  return errorResponse(
    res,
    statusCode,
    message,
    config.env === 'development' ? {
      errors,
      stack: err.stack,
      details: err
    } : errors
  );
