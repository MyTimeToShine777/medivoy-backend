generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Accommodation {
  accommodationId         String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  bookingId               String?   @db.Uuid
  userId                  String    @db.Uuid
  cityId                  String?   @db.Uuid
  hospitalId              String?   @db.Uuid
  
  // ACCOMMODATION DETAILS
  type                    String    @db.VarChar(50)
  name                    String    @db.VarChar(150)
  address                 String    @db.Text
  city                    String    @db.VarChar(255)
  state                   String?   @db.VarChar(255)
  postalCode              String?   @db.VarChar(50)
  latitude                Decimal?  @db.Decimal(10, 8)
  longitude               Decimal?  @db.Decimal(11, 8)
  distanceFromHospital    Decimal?  @db.Decimal(5, 2)
  
  // CONTACT
  phone                   String?   @db.VarChar(255)
  email                   String?   @db.VarChar(255)
  website                 String?   @db.VarChar(255)
  contactPerson           String?   @db.VarChar(255)
  
  // BOOKING DATES
  checkInDate             DateTime
  checkOutDate            DateTime
  numberOfNights          Int?
  numberOfRooms           Int       @default(1)
  numberOfGuests          Int
  companionNames          Json?
  
  // ROOM DETAILS
  roomType                String?   @db.VarChar(50)
  bedType                 String?   @db.VarChar(50)
  roomAmenities           Json?
  mealInclusion           String?   @default("breakfast") @db.VarChar(50)
  mealDetails             Json?
  
  // PRICING
  pricePerNight           Decimal   @db.Decimal(10, 2)
  totalPrice              Decimal   @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  discount                Decimal   @default(0) @db.Decimal(10, 2)
  tax                     Decimal   @default(0) @db.Decimal(10, 2)
  finalPrice              Decimal   @db.Decimal(12, 2)
  cancellationPolicy      String?   @db.Text
  
  // BOOKING STATUS
  status                  String    @default("pending") @db.VarChar(50)
  confirmationNumber      String?   @unique @db.VarChar(255)
  bookingConfirmedAt      DateTime?
  checkedInAt             DateTime?
  checkedOutAt            DateTime?
  
  // AMENITIES & SERVICES
  amenities               Json?
  availableServices       Json?
  
  // SPECIAL REQUIREMENTS
  specialRequirements     String?   @db.Text
  accessibilityRequirements Json?
  dietaryRestrictions     Json?
  
  // RATINGS & FEEDBACK
  rating                  Decimal?  @db.Decimal(3, 2)
  cleanliness             Decimal?  @db.Decimal(3, 2)
  comfort                 Decimal?  @db.Decimal(3, 2)
  service                 Decimal?  @db.Decimal(3, 2)
  valueForMoney           Decimal?  @db.Decimal(3, 2)
  feedback                String?   @db.Text
  reviewSubmittedAt       DateTime?
  
  // PAYMENT
  isPaid                  Boolean   @default(false)
  paymentMethod           String?   @db.VarChar(50)
  paymentId               Int?
  paidAt                  DateTime?
  
  // DOCUMENTS & MEDIA
  images                  Json?
  bookingConfirmation     String?   @db.VarChar(500)
  guestId                 String?   @db.VarChar(255)
  
  // METADATA & NOTES
  internalNotes           String?   @db.Text
  tags                    Json?
  isActive                Boolean   @default(true)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  booking                 Booking?  @relation(fields: [bookingId], references: [bookingId], onDelete: SetNull)
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  cityRelation            City?     @relation(fields: [cityId], references: [cityId], onDelete: SetNull)
  hospital                Hospital? @relation(fields: [hospitalId], references: [hospitalId], onDelete: SetNull)
  payment                 Payment?  @relation(fields: [paymentId], references: [id], onDelete: SetNull)
  
  @@index([bookingId])
  @@index([userId])
  @@index([status])
  @@index([checkInDate])
  @@map("accommodations")
}

model Activity {
  activityId              String    @id @default(uuid()) @db.Uuid
  userId                  String?   @db.Uuid
  sessionId               String?   @db.Uuid
  type                    String    @db.VarChar(50)
  action                  String    @db.VarChar(100)
  entityType              String?   @db.VarChar(50)
  entityId                String?   @db.Uuid
  metadata                Json?
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  createdAt               DateTime  @default(now())
  
  @@index([userId])
  @@index([sessionId])
  @@index([type])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("activities")
}

model Appointment {
  appointmentId           String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String?   @db.Uuid
  patientId               String    @db.Uuid
  doctorId                String    @db.Uuid
  hospitalId              String?   @db.Uuid
  departmentId            String?   @db.Uuid
  bookingId               String?   @db.Uuid
  
  // APPOINTMENT DETAILS
  appointmentNumber       String    @unique @db.VarChar(50)
  appointmentType         String    @db.VarChar(50)
  appointmentDate         DateTime  @db.Date
  appointmentTime         DateTime  @db.Time
  duration                Int       @default(30)
  endTime                 DateTime? @db.Time
  status                  String    @default("scheduled") @db.VarChar(50)
  
  // SYMPTOMS & REASON
  reasonForVisit          String?   @db.Text
  symptoms                Json?
  chiefComplaint          String?   @db.Text
  presentingIssue         String?   @db.Text
  urgencyLevel            String?   @default("normal") @db.VarChar(20)
  
  // CONSULTATION MODE
  consultationType        String    @default("in-person") @db.VarChar(50)
  meetingLink             String?   @db.VarChar(500)
  meetingId               String?   @db.VarChar(255)
  meetingPassword         String?   @db.VarChar(255)
  roomNumber              String?   @db.VarChar(50)
  
  // APPOINTMENT LIFECYCLE
  scheduledAt             DateTime  @default(now())
  confirmedAt             DateTime?
  checkedInAt             DateTime?
  startedAt               DateTime?
  completedAt             DateTime?
  cancelledAt             DateTime?
  cancellationReason      String?   @db.Text
  cancelledBy             String?   @db.Uuid
  rescheduledFrom         String?   @db.Uuid
  rescheduledTo           String?   @db.Uuid
  noShowAt                DateTime?
  
  // REMINDERS & NOTIFICATIONS
  reminderSent            Boolean   @default(false)
  reminderSentAt          DateTime?
  confirmationSent        Boolean   @default(false)
  confirmationSentAt      DateTime?
  followUpRequired        Boolean   @default(false)
  followUpDate            DateTime?
  
  // PAYMENT & BILLING
  consultationFee         Decimal   @db.Decimal(10, 2)
  currency                String    @default("USD") @db.VarChar(3)
  isPaid                  Boolean   @default(false)
  paymentId               Int?      // Changed to Int? to match Payment.id type
  paymentMethod           String?   @db.VarChar(50)
  paidAt                  DateTime?
  invoiceId               String?   @db.Uuid
  
  // MEDICAL RECORDS
  vitalSigns              Json?
  diagnosis               String?   @db.Text
  prescriptionId          String?   @db.Uuid @unique  // Unique for 1:1 relation
  
  labTestsOrdered         Json?
  referralGiven           Boolean   @default(false)
  referralDoctorId        String?   @db.Uuid
  referralNotes           String?   @db.Text
  
  // NOTES & OBSERVATIONS
  doctorNotes             String?   @db.Text
  nurseNotes              String?   @db.Text
  internalNotes           String?   @db.Text
  patientNotes            String?   @db.Text
  
  // RATINGS & FEEDBACK
  patientRating           Int?
  patientFeedback         String?   @db.Text
  feedbackSubmittedAt     DateTime?
  
  // TECHNICAL
  source                  String?   @default("web") @db.VarChar(50)
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  
  // METADATA
  isActive                Boolean   @default(true)
  tags                    Json?
  metadata                Json?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User?     @relation(fields: [userId], references: [userId], onDelete: SetNull)
  doctor                  Doctor    @relation(fields: [doctorId], references: [doctorId], onDelete: Cascade)
  hospital                Hospital? @relation(fields: [hospitalId], references: [hospitalId], onDelete: SetNull)
  department              Department? @relation(fields: [departmentId], references: [departmentId], onDelete: SetNull)
  booking                 Booking?  @relation(fields: [bookingId], references: [bookingId], onDelete: SetNull)
  payment                 Payment?  @relation(fields: [paymentId], references: [id], onDelete: SetNull)
  invoice                 Invoice?  @relation(fields: [invoiceId], references: [invoiceId], onDelete: SetNull)
  prescription            Prescription? @relation(fields: [prescriptionId], references: [prescriptionId], onDelete: SetNull)
  labTests               LabTest[]
  
  @@index([userId])
  @@index([patientId])
  @@index([doctorId])
  @@index([hospitalId])
  @@index([bookingId])
  @@index([appointmentDate])
  @@index([status])
  @@index([appointmentType])
  @@map("appointments")
}

model AuditLog {
  auditLogId              String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String?   @db.Uuid
  
  // ACTION DETAILS
  action                  String    @db.VarChar(100)
  entity                  String?   @db.VarChar(100)
  entityId                String?   @db.Uuid
  
  // CHANGE TRACKING
  oldValues               Json?
  newValues               Json?
  changes                 Json?
  
  // REQUEST INFO
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  requestMethod           String?   @db.VarChar(10)
  requestUrl              String?   @db.VarChar(500)
  requestBody             Json?
  responseStatus          Int?
  responseTime            Int?
  
  // METADATA
  metadata                Json?
  tags                    Json?
  severity                String?   @default("info") @db.VarChar(20)
  status                  String?   @db.VarChar(50)
  errorMessage            String?   @db.Text
  stackTrace              String?   @db.Text
  
  // SESSION INFO
  sessionId               String?   @db.Uuid
  deviceId                String?   @db.Uuid
  
  createdAt               DateTime  @default(now())
  
  // RELATIONS
  user                    User?     @relation(fields: [userId], references: [userId], onDelete: SetNull)
  
  @@index([userId])
  @@index([action])
  @@index([entity])
  @@index([entityId])
  @@index([createdAt])
  @@index([severity])
  @@map("audit_logs")
}

model Backup {
  backupId                String    @id @default(uuid()) @db.Uuid
  
  // BACKUP DETAILS
  backupType              String    @db.VarChar(50)
  backupName              String    @db.VarChar(255)
  backupLocation          String    @db.VarChar(500)
  fileName                String    @db.VarChar(255)
  fileSize                BigInt?
  fileSizeReadable        String?   @db.VarChar(50)
  
  // STATUS
  status                  String    @default("pending") @db.VarChar(50)
  startedAt               DateTime?
  completedAt             DateTime?
  failedAt                DateTime?
  
  // CONFIGURATION
  compressionEnabled      Boolean   @default(true)
  encryptionEnabled       Boolean   @default(false)
  retentionDays           Int       @default(30)
  
  // BACKUP SCOPE
  tables                  Json?
  databases               Json?
  excludedTables          Json?
  
  // RESULTS
  totalRecords            Int?
  successfulRecords       Int?
  failedRecords           Int?
  errorMessage            String?   @db.Text
  errorDetails            Json?
  
  // METADATA
  triggerType             String?   @default("manual") @db.VarChar(50)
  triggeredBy             String?   @db.Uuid
  scheduledBackupId       String?   @db.Uuid
  metadata                Json?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  logs                    BackupLog[]
  
  @@index([status])
  @@index([backupType])
  @@index([createdAt])
  @@map("backups")
}

model BackupLog {
  logId                   String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  backupId                String    @db.Uuid
  
  // LOG DETAILS
  logLevel                String    @default("info") @db.VarChar(20)
  message                 String    @db.Text
  details                 Json?
  errorStack              String?   @db.Text
  
  // PROGRESS
  currentStep             String?   @db.VarChar(100)
  totalSteps              Int?
  completedSteps          Int?
  progressPercentage      Decimal?  @db.Decimal(5, 2)
  
  createdAt               DateTime  @default(now())
  
  // RELATIONS
  backup                  Backup    @relation(fields: [backupId], references: [backupId], onDelete: Cascade)
  
  @@index([backupId])
  @@index([logLevel])
  @@index([createdAt])
  @@map("backup_logs")
}

model Booking {
  bookingId               String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS (foreign keys)
  userId                  String    @db.Uuid
  patientId               String?   @db.Uuid
  treatmentId             String?   @db.Uuid
  hospitalId              String?   @db.Uuid
  doctorId                String?   @db.Uuid
  countryId               String?   @db.Uuid
  cityId                  String?   @db.Uuid
  packageId               String?   @db.Uuid
  departmentId            String?   @db.Uuid
  
  // BOOKING IDENTIFIERS
  bookingNumber           String    @unique @db.VarChar(50)
  referenceNumber         String?   @unique @db.VarChar(100)
  externalBookingId       String?   @db.VarChar(255)
  
  // BOOKING TYPE & STATUS
  bookingType             String    @db.VarChar(50)
  status                  String    @default("pending") @db.VarChar(50)
  priority                String?   @default("normal") @db.VarChar(20)
  
  // PRICING - DYNAMIC CALCULATION
  basePrice               Decimal   @db.Decimal(12, 2)
  addOnsPrice             Decimal   @default(0) @db.Decimal(12, 2)
  accommodationPrice      Decimal   @default(0) @db.Decimal(12, 2)
  travelPrice             Decimal   @default(0) @db.Decimal(12, 2)
  subtotal                Decimal   @db.Decimal(12, 2)
  discount                Decimal   @default(0) @db.Decimal(12, 2)
  discountType            String?   @db.VarChar(50)
  discountCode            String?   @db.VarChar(100)
  tax                     Decimal   @default(0) @db.Decimal(12, 2)
  taxPercentage           Decimal   @default(0) @db.Decimal(5, 2)
  totalPrice              Decimal   @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  exchangeRate            Decimal?  @db.Decimal(10, 4)
  
  // PAYMENT
  paymentStatus           String    @default("pending") @db.VarChar(50)
  paidAmount              Decimal   @default(0) @db.Decimal(12, 2)
  remainingAmount         Decimal?  @db.Decimal(12, 2)
  paymentMethod           String?   @db.VarChar(50)
  paymentDueDate          DateTime?
  
  // APPOINTMENT DETAILS
  appointmentDate         DateTime?
  appointmentTime         DateTime? @db.Time
  estimatedDuration       Int?
  appointmentEndTime      DateTime? @db.Time
  
  // TRAVEL & ACCOMMODATION
  arrivalDate             DateTime?
  departureDate           DateTime?
  numberOfNights          Int?
  numberOfTravelers       Int       @default(1)
  numberOfCompanions      Int       @default(0)
  
  // PATIENT INFORMATION
  patientName             String?   @db.VarChar(255)
  patientAge              Int?
  patientGender           String?   @db.VarChar(20)
  patientEmail            String?   @db.VarChar(255)
  patientPhone            String?   @db.VarChar(20)
  patientCity             String?   @db.VarChar(100)
  
  // MEDICAL INFORMATION
  comorbidConditions      Json?
  allergies               Json?
  currentMedications      Json?
  medicalHistory          String?   @db.Text
  specialRequirements     String?   @db.Text
  
  // INSURANCE
  hasInsurance            Boolean   @default(false)
  insuranceProvider       String?   @db.VarChar(255)
  insuranceNumber         String?   @db.VarChar(100)
  insuranceCoverage       Decimal?  @db.Decimal(12, 2)
  
  // EXPERT CALL WORKFLOW
  expertCallStatus        String    @default("pending") @db.VarChar(50)
  expertCallScheduledAt   DateTime?
  expertCallCompletedAt   DateTime?
  expertCallNotes         String?   @db.Text
  expertCallRecordingUrl  String?   @db.VarChar(500)
  
  // DOCUMENT UPLOAD WORKFLOW
  documentsRequired       Json?
  documentsUploaded       Json?
  documentsVerified       Boolean   @default(false)
  documentsVerifiedAt     DateTime?
  documentsVerifiedBy     String?   @db.Uuid
  
  // BOOKING LIFECYCLE
  requestedAt             DateTime  @default(now())
  confirmedAt             DateTime?
  approvedAt              DateTime?
  approvedBy              String?   @db.Uuid
  startedAt               DateTime?
  completedAt             DateTime?
  cancelledAt             DateTime?
  cancellationReason      String?   @db.Text
  cancelledBy             String?   @db.Uuid
  
  // REFUNDS
  refundAmount            Decimal?  @db.Decimal(12, 2)
  refundStatus            String?   @db.VarChar(50)
  refundRequestedAt       DateTime?
  refundProcessedAt       DateTime?
  refundReason            String?   @db.Text
  
  // NOTES & COMMUNICATION
  notes                   String?   @db.Text
  internalNotes           String?   @db.Text
  patientNotes            String?   @db.Text
  adminNotes              String?   @db.Text
  
  // RATINGS & FEEDBACK
  rating                  Int?
  feedback                String?   @db.Text
  feedbackSubmittedAt     DateTime?
  
  // SOURCE & TRACKING
  source                  String?   @default("web") @db.VarChar(50)
  utmSource               String?   @db.VarChar(255)
  utmMedium               String?   @db.VarChar(255)
  utmCampaign             String?   @db.VarChar(255)
  referralCode            String?   @db.VarChar(100)
  
  // METADATA
  metadata                Json?
  tags                    Json?
  isActive                Boolean   @default(true)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  patient                 Patient?  @relation(fields: [patientId], references: [patientId], onDelete: SetNull)
  treatment               Treatment? @relation(fields: [treatmentId], references: [treatmentId], onDelete: SetNull)
  hospital                Hospital? @relation(fields: [hospitalId], references: [hospitalId], onDelete: SetNull)
  country                 Country?  @relation(fields: [countryId], references: [countryId], onDelete: SetNull)
  city                    City?     @relation(fields: [cityId], references: [cityId], onDelete: SetNull)
  package                 Package?  @relation(fields: [packageId], references: [packageId], onDelete: SetNull)
  department              Department? @relation(fields: [departmentId], references: [departmentId], onDelete: SetNull)

  expertCalls             ExpertCall[]
  addOns                  BookingAddOn[]
  preferences             BookingPreferences?
  statusHistory           BookingStatusHistory[]
  reviews                 BookingReview[]
  payments                Payment[]
  invoices                Invoice[]
  documents               Document[]
  accommodations          Accommodation[]
  companions              Companion[]
  consultations           Consultation[]
  appointments            Appointment[]
  flights                 Flight[]
  insuranceDocuments      InsuranceDocument[]
  refunds                 Refund[]
  trains                  Train[]
  travelArrangements      TravelArrangement[]
  
  @@index([userId])
  @@index([patientId])
  @@index([treatmentId])
  @@index([hospitalId])
  @@index([countryId])
  @@index([cityId])
  @@index([status])
  @@index([paymentStatus])
  @@index([expertCallStatus])
  @@index([bookingType])
  @@index([createdAt])
  @@map("bookings")
}

model BookingAddOn {
  addOnId                 String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  bookingId               String    @db.Uuid
  
  // ADD-ON DETAILS
  addOnType               String    @db.VarChar(100)
  addOnName               String    @db.VarChar(255)
  addOnDescription        String?   @db.Text
  category                String?   @db.VarChar(50)
  subcategory             String?   @db.VarChar(50)
  
  // PRICING
  addOnPrice              Decimal   @db.Decimal(10, 2)
  currency                String    @default("USD") @db.VarChar(3)
  quantity                Int       @default(1)
  totalPrice              Decimal   @db.Decimal(10, 2)
  discount                Decimal   @default(0) @db.Decimal(10, 2)
  finalPrice              Decimal   @db.Decimal(10, 2)
  
  // SELECTION & STATUS
  isSelected              Boolean   @default(true)
  isMandatory             Boolean   @default(false)
  isCustom                Boolean   @default(false)
  status                  String    @default("active") @db.VarChar(50)
  
  // DETAILS
  details                 Json?
  specifications          Json?
  features                Json?
  
  // METADATA
  displayOrder            Int?
  isActive                Boolean   @default(true)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  // Optional link to master feature definition
  featureAddOnId          String?   @db.Uuid
  featureAddOn            FeatureAddOn? @relation(fields: [featureAddOnId], references: [addOnId], onDelete: SetNull)
  
  @@index([bookingId])
  @@index([addOnType])
  @@index([category])
  @@index([isSelected])
  @@map("booking_add_ons")
}

model BookingPreferences {
  preferenceId            String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  bookingId               String    @unique @db.Uuid
  
  // ACCOMMODATION PREFERENCES
  accommodationType       String?   @db.VarChar(100)
  roomType                String?   @db.VarChar(50)
  bedType                 String?   @db.VarChar(50)
  smokingPreference       String?   @default("non-smoking") @db.VarChar(50)
  floorPreference         String?   @db.VarChar(50)
  viewPreference          String?   @db.VarChar(50)
  
  // DIETARY PREFERENCES
  dietaryRequirements     String?   @db.Text
  dietType                String?   @db.VarChar(50)
  allergies               Json?
  foodPreferences         Json?
  mealTimings             Json?
  
  // SPECIAL REQUIREMENTS
  specialRequests         String?   @db.Text
  medicalEquipment        Json?
  accessibilityNeeds      Json?
  mobilityAssistance      Boolean   @default(false)
  wheelchairRequired      Boolean   @default(false)
  oxygenRequired          Boolean   @default(false)
  
  // COMMUNICATION PREFERENCES
  languagePreference      String?   @db.VarChar(50)
  interpreterRequired     Boolean   @default(false)
  interpreterLanguage     String?   @db.VarChar(50)
  communicationMode       String?   @default("email") @db.VarChar(50)
  
  // TRAVEL PREFERENCES
  transportationNeeded    Boolean   @default(false)
  transportationType      String?   @db.VarChar(50)
  pickupLocation          String?   @db.VarChar(255)
  dropoffLocation         String?   @db.VarChar(255)
  flightPreferences       Json?
  
  // VISA & DOCUMENTATION
  visaAssistanceNeeded    Boolean   @default(false)
  passportNumber          String?   @db.VarChar(50)
  passportExpiry          DateTime?
  visaStatus              String?   @db.VarChar(50)
  
  // COMPANIONS
  companionCount          Int       @default(0)
  companionDetails        Json?
  companionAccommodation  Boolean   @default(false)
  
  // ADDITIONAL SERVICES
  additionalServices      Json?
  tourismInterest         Boolean   @default(false)
  tourPreferences         Json?
  
  // METADATA
  notes                   String?   @db.Text
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  
  @@index([bookingId])
  @@map("booking_preferences")
}

model BookingReview {
  reviewId                String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  bookingId               String    @unique @db.Uuid
  
  // OVERALL RATING
  rating                  Int
  comment                 String?   @db.Text
  
  // DETAILED RATINGS
  serviceRating           Int?
  hospitalRating          Int?
  doctorRating            Int?
  accommodationRating     Int?
  foodRating              Int?
  cleanlinessRating       Int?
  staffRating             Int?
  facilitiesRating        Int?
  valueForMoneyRating     Int?
  
  // SPECIFIC FEEDBACK
  treatmentFeedback       String?   @db.Text
  hospitalFeedback        String?   @db.Text
  doctorFeedback          String?   @db.Text
  accommodationFeedback   String?   @db.Text
  
  // RECOMMENDATION
  wouldRecommend          Boolean   @default(true)
  recommendationReason    String?   @db.Text
  
  // EXPERIENCE DETAILS
  positiveAspects         Json?
  negativeAspects         Json?
  suggestions             String?   @db.Text
  
  // VERIFICATION
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  verifiedBy              String?   @db.Uuid
  
  // VISIBILITY
  isPublished             Boolean   @default(false)
  publishedAt             DateTime?
  isVisible               Boolean   @default(true)
  
  // MODERATION
  moderationStatus        String?   @default("pending") @db.VarChar(50)
  moderatedAt             DateTime?
  moderatedBy             String?   @db.Uuid
  moderationNotes         String?   @db.Text
  
  // HELPFULNESS
  helpfulCount            Int       @default(0)
  unhelpfulCount          Int       @default(0)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  
  @@index([bookingId])
  @@index([rating])
  @@index([isVerified])
  @@index([isPublished])
  @@map("booking_reviews")
}

model BookingStatusHistory {
  historyId               String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  bookingId               String    @db.Uuid
  
  // STATUS CHANGE
  previousStatus          String?   @db.VarChar(50)
  newStatus               String    @db.VarChar(50)
  
  // CHANGE DETAILS
  changedBy               String?   @db.Uuid
  changedByRole           String?   @db.VarChar(50)
  reason                  String?   @db.Text
  notes                   String?   @db.Text
  
  // METADATA
  metadata                Json?
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  
  // NOTIFICATION
  notificationSent        Boolean   @default(false)
  notificationSentAt      DateTime?
  
  createdAt               DateTime  @default(now())
  
  // RELATIONS
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  
  @@index([bookingId])
  @@index([newStatus])
  @@index([createdAt])
  @@map("booking_status_history")
}

model ChatConversation {
  conversationId          String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  senderId                String    @db.Uuid
  receiverId              String    @db.Uuid
  bookingId               String?   @db.Uuid
  
  // CONVERSATION DETAILS
  title                   String?   @db.VarChar(255)
  type                    String    @default("direct") @db.VarChar(50)
  status                  String    @default("active") @db.VarChar(50)
  
  // METADATA
  lastMessageAt           DateTime?
  lastMessagePreview      String?   @db.VarChar(500)
  unreadCount             Int       @default(0)
  
  // SETTINGS
  isMuted                 Boolean   @default(false)
  mutedUntil              DateTime?
  isArchived              Boolean   @default(false)
  archivedAt              DateTime?
  isPinned                Boolean   @default(false)
  pinnedAt                DateTime?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  sender                  User      @relation("SenderConversations", fields: [senderId], references: [userId], onDelete: Cascade)
  receiver                User      @relation("ReceiverConversations", fields: [receiverId], references: [userId], onDelete: Cascade)
  messages                ChatMessage[]
  
  @@index([senderId])
  @@index([receiverId])
  @@index([bookingId])
  @@index([status])
  @@map("chat_conversations")
}

model ChatMessage {
  messageId               String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  conversationId          String    @db.Uuid
  senderId                String    @db.Uuid
  
  // MESSAGE CONTENT
  message                 String    @db.Text
  messageType             String    @default("text") @db.VarChar(50)
  
  // ATTACHMENTS
  attachments             Json?
  mediaUrl                String?   @db.VarChar(500)
  mediaType               String?   @db.VarChar(50)
  thumbnailUrl            String?   @db.VarChar(500)
  
  // STATUS
  isRead                  Boolean   @default(false)
  readAt                  DateTime?
  isDelivered             Boolean   @default(false)
  deliveredAt             DateTime?
  isDeleted               Boolean   @default(false)
  deletedAt               DateTime?
  deletedBy               String?   @db.Uuid
  
  // REPLY/FORWARD
  replyToMessageId        String?   @db.Uuid
  forwardedFromMessageId  String?   @db.Uuid
  isForwarded             Boolean   @default(false)
  
  // METADATA
  metadata                Json?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  conversation            ChatConversation @relation(fields: [conversationId], references: [conversationId], onDelete: Cascade)
  sender                  User      @relation("SentMessages", fields: [senderId], references: [userId], onDelete: Cascade)
  
  @@index([conversationId])
  @@index([senderId])
  @@index([isRead])
  @@index([createdAt])
  @@map("chat_messages")
}

model City {
  cityId                  String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  countryId               String    @db.Uuid
  stateId                 String?   @db.Uuid
  
  // CITY DETAILS
  cityName                String    @db.VarChar(255)
  cityNameLocal           String?   @db.VarChar(255)
  stateOrProvince         String?   @db.VarChar(255)
  
  // GEOGRAPHIC
  latitude                Decimal?  @db.Decimal(10, 8)
  longitude               Decimal?  @db.Decimal(11, 8)
  timezone                String?   @db.VarChar(100)
  elevation               Int?
  
  // CODES
  isoCode                 String?   @db.VarChar(10)
  postalCode              String?   @db.VarChar(20)
  areaCode                String?   @db.VarChar(10)
  
  // DEMOGRAPHICS
  population              BigInt?
  populationYear          Int?
  area                    Decimal?  @db.Decimal(10, 2)
  density                 Decimal?  @db.Decimal(10, 2)
  
  // DESCRIPTION
  description             String?   @db.Text
  descriptionLocal        String?   @db.Text
  shortDescription        String?   @db.VarChar(500)
  
  // MEDICAL TOURISM
  isMedicalTourismHub     Boolean   @default(false)
  popularFor              Json?
  specialties             Json?
  
  // STATISTICS
  hospitalCount           Int       @default(0)
  doctorCount             Int       @default(0)
  treatmentCount          Int       @default(0)
  averageRating           Decimal?  @db.Decimal(3, 2)
  totalReviews            Int       @default(0)
  
  // MEDIA
  imageUrl                String?   @db.VarChar(500)
  images                  Json?
  videoUrl                String?   @db.VarChar(500)
  
  // SEO
  slug                    String    @unique @db.VarChar(255)
  metaTitle               String?   @db.VarChar(255)
  metaDescription         String?   @db.VarChar(500)
  metaKeywords            String?   @db.VarChar(500)
  
  // VISIBILITY
  isActive                Boolean   @default(true)
  isFeatured              Boolean   @default(false)
  displayOrder            Int       @default(0)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  country                 Country   @relation(fields: [countryId], references: [countryId], onDelete: Cascade)
  state                   State?    @relation(fields: [stateId], references: [stateId], onDelete: SetNull)
  hospitals               Hospital[]
  bookings                Booking[]
  accommodations          Accommodation[]
  packages                Package[]
  
  @@index([countryId])
  @@index([cityName])
  @@index([slug])
  @@index([isActive])
  @@index([isFeatured])
  @@map("cities")
}

model ComorbidCondition {
  comorbidId              String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  patientId               String    @db.Uuid
  
  // CONDITION DETAILS
  conditionName           String    @db.VarChar(255)
  conditionCode           String?   @db.VarChar(50)
  icdCode                 String?   @db.VarChar(20)
  
  // DIAGNOSIS
  diagnosedDate           DateTime? @db.Date
  diagnosedBy             String?   @db.VarChar(255)
  diagnosisFacility       String?   @db.VarChar(255)
  
  // SEVERITY
  severity                String?   @db.VarChar(50)
  status                  String    @default("active") @db.VarChar(50)
  
  // TREATMENT
  currentTreatment        String?   @db.Text
  medications             Json?
  treatmentStartDate      DateTime? @db.Date
  
  // MONITORING
  lastReviewDate          DateTime? @db.Date
  nextReviewDate          DateTime? @db.Date
  monitoringFrequency     String?   @db.VarChar(50)
  
  // IMPACT
  impactOnDailyLiving    String?   @db.Text
  restrictions            Json?
  precautions             String?   @db.Text
  
  // NOTES
  notes                   String?   @db.Text
  clinicalNotes           String?   @db.Text
  
  // METADATA
  isActive                Boolean   @default(true)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  
  @@index([patientId])
  @@index([conditionName])
  @@index([status])
  @@map("comorbid_conditions")
}

model Companion {
  companionId             String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String    @db.Uuid
  bookingId               String    @db.Uuid
  
  // COMPANION DETAILS
  firstName               String    @db.VarChar(100)
  lastName                String    @db.VarChar(100)
  fullName                String    @db.VarChar(255)
  relationship            String    @db.VarChar(50)
  
  // CONTACT
  email                   String?   @db.VarChar(255)
  phoneNumber             String?   @db.VarChar(20)
  alternatePhone          String?   @db.VarChar(20)
  
  // PERSONAL DETAILS
  dateOfBirth             DateTime? @db.Date
  age                     Int?
  gender                  String?   @db.VarChar(20)
  nationality             String?   @db.VarChar(100)
  
  // IDENTIFICATION
  passportNumber          String?   @db.VarChar(50)
  passportExpiry          DateTime? @db.Date
  idType                  String?   @db.VarChar(50)
  idNumber                String?   @db.VarChar(100)
  
  // ADDRESS
  address                 String?   @db.Text
  city                    String?   @db.VarChar(100)
  state                   String?   @db.VarChar(100)
  country                 String?   @db.VarChar(100)
  postalCode              String?   @db.VarChar(20)
  
  // MEDICAL INFO
  bloodGroup              String?   @db.VarChar(10)
  allergies               Json?
  medicalConditions       Json?
  emergencyMedication     String?   @db.Text
  
  // EMERGENCY CONTACT
  emergencyContactName    String?   @db.VarChar(255)
  emergencyContactPhone   String?   @db.VarChar(20)
  emergencyContactRelation String?  @db.VarChar(50)
  
  // ACCOMMODATION
  needsAccommodation      Boolean   @default(false)
  accommodationId         String?   @db.Uuid
  roomSharing             Boolean   @default(true)
  
  // DIETARY
  dietaryRestrictions     Json?
  foodAllergies           Json?
  mealPreferences         String?   @db.Text
  
  // SPECIAL REQUIREMENTS
  specialRequirements     String?   @db.Text
  accessibilityNeeds      Json?
  mobilityAssistance      Boolean   @default(false)
  
  // METADATA
  notes                   String?   @db.Text
  internalNotes           String?   @db.Text
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  
  @@index([userId])
  @@index([bookingId])
  @@map("companions")
}

model Consultation {
  consultationId          String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String    @db.Uuid
  patientId               String    @db.Uuid
  doctorId                String    @db.Uuid
  bookingId               String?   @db.Uuid
  hospitalId              String?   @db.Uuid
  
  // CONSULTATION DETAILS
  consultationNumber      String    @unique @db.VarChar(50)
  consultationType        String    @db.VarChar(50)
  consultationDate        DateTime  @db.Date
  consultationTime        DateTime  @db.Time
  duration                Int       @default(30)
  status                  String    @default("scheduled") @db.VarChar(50)
  
  // CHIEF COMPLAINT
  chiefComplaint          String    @db.Text
  symptoms                Json?
  symptomDuration         String?   @db.VarChar(100)
  symptomSeverity         String?   @db.VarChar(50)
  
  // HISTORY
  presentIllness          String?   @db.Text
  pastMedicalHistory      String?   @db.Text
  familyHistory           String?   @db.Text
  socialHistory           String?   @db.Text
  allergies               Json?
  currentMedications      Json?
  
  // PHYSICAL EXAMINATION
  vitalSigns              Json?
  generalAppearance       String?   @db.Text
  systemicExamination     Json?
  physicalFindings        String?   @db.Text
  
  // INVESTIGATIONS
  investigationsOrdered   Json?
  labTestsOrdered         Json?
  imagingOrdered          Json?
  investigationResults    Json?
  
  // DIAGNOSIS
  provisionalDiagnosis    String?   @db.Text
  finalDiagnosis          String?   @db.Text
  differentialDiagnosis   Json?
  icdCodes                Json?
  
  // TREATMENT PLAN
  treatmentPlan           String?   @db.Text
  prescriptions           Json?
  proceduresRecommended   Json?
  surgeryRecommended      Boolean   @default(false)
  surgeryDetails          String?   @db.Text
  
  // FOLLOW-UP
  followUpRequired        Boolean   @default(false)
  followUpDate            DateTime? @db.Date
  followUpNotes           String?   @db.Text
  
  // REFERRAL
  referralRequired        Boolean   @default(false)
  referralTo              String?   @db.Uuid
  referralSpecialty       String?   @db.VarChar(255)
  referralReason          String?   @db.Text
  referralNotes           String?   @db.Text
  
  // DOCTOR NOTES
  doctorNotes             String?   @db.Text
  clinicalNotes           String?   @db.Text
  privateNotes            String?   @db.Text
  
  // PATIENT EDUCATION
  adviceGiven             String?   @db.Text
  lifestyleModifications  Json?
  dietaryAdvice           String?   @db.Text
  exerciseAdvice          String?   @db.Text
  
  // DOCUMENTATION
  attachments             Json?
  recordingUrl            String?   @db.VarChar(500)
  transcriptUrl           String?   @db.VarChar(500)
  
  // PAYMENT
  consultationFee         Decimal   @db.Decimal(10, 2)
  currency                String    @default("USD") @db.VarChar(3)
  isPaid                  Boolean   @default(false)
  paymentId               String?   @db.Uuid
  
  // METADATA
  completedAt             DateTime?
  cancelledAt             DateTime?
  cancellationReason      String?   @db.Text
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  doctor                  Doctor    @relation(fields: [doctorId], references: [doctorId], onDelete: Cascade)
  booking                 Booking?  @relation(fields: [bookingId], references: [bookingId], onDelete: SetNull)
  hospital                Hospital? @relation(fields: [hospitalId], references: [hospitalId], onDelete: SetNull)
  
  @@index([userId])
  @@index([patientId])
  @@index([doctorId])
  @@index([bookingId])
  @@index([consultationDate])
  @@index([status])
  @@map("consultations")
}

model Country {
  countryId               String    @id @default(uuid()) @db.Uuid
  
  // COUNTRY DETAILS
  countryName             String    @unique @db.VarChar(255)
  countryNameLocal        String?   @db.VarChar(255)
  officialName            String?   @db.VarChar(255)
  
  // CODES
  iso2Code                String    @unique @db.VarChar(2)
  iso3Code                String    @unique @db.VarChar(3)
  numericCode             String?   @db.VarChar(10)
  callingCode             String?   @db.VarChar(10)
  
  // GEOGRAPHIC
  continent               String?   @db.VarChar(50)
  region                  String?   @db.VarChar(100)
  subregion               String?   @db.VarChar(100)
  latitude                Decimal?  @db.Decimal(10, 8)
  longitude               Decimal?  @db.Decimal(11, 8)
  
  // DEMOGRAPHICS
  capital                 String?   @db.VarChar(255)
  population              BigInt?
  area                    Decimal?  @db.Decimal(15, 2)
  
  // CURRENCY
  currencyCode            String?   @db.VarChar(3)
  currencyName            String?   @db.VarChar(100)
  currencySymbol          String?   @db.VarChar(10)
  
  // LANGUAGE
  languages               Json?
  primaryLanguage         String?   @db.VarChar(100)
  
  // DESCRIPTION
  description             String?   @db.Text
  descriptionLocal        String?   @db.Text
  shortDescription        String?   @db.VarChar(500)
  
  // MEDICAL TOURISM
  isMedicalTourismDestination Boolean @default(false)
  popularFor              Json?
  specialties             Json?
  medicalTourismRanking   Int?
  
  // VISA INFORMATION
  visaRequired            Boolean   @default(true)
  visaOnArrival           Boolean   @default(false)
  eVisaAvailable          Boolean   @default(false)
  visaFee                 Decimal?  @db.Decimal(10, 2)
  visaProcessingDays      Int?
  visaValidityDays        Int?
  visaInfo                String?   @db.Text
  
  // STATISTICS
  hospitalCount           Int       @default(0)
  doctorCount             Int       @default(0)
  cityCount               Int       @default(0)
  treatmentCount          Int       @default(0)
  averageRating           Decimal?  @db.Decimal(3, 2)
  totalReviews            Int       @default(0)
  
  // MEDIA
  flagUrl                 String?   @db.VarChar(500)
  imageUrl                String?   @db.VarChar(500)
  images                  Json?
  
  // SEO
  slug                    String    @unique @db.VarChar(255)
  metaTitle               String?   @db.VarChar(255)
  metaDescription         String?   @db.VarChar(500)
  metaKeywords            String?   @db.VarChar(500)
  
  // VISIBILITY
  isActive                Boolean   @default(true)
  isFeatured              Boolean   @default(false)
  displayOrder            Int       @default(0)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  cities                  City[]
  hospitals               Hospital[]
  bookings                Booking[]
  packages                Package[]
  states                  State[]
  
  @@index([countryName])
  @@index([iso2Code])
  @@index([slug])
  @@index([isActive])
  @@index([isFeatured])
  @@map("countries")
}

model Coupon {
  couponId                String    @id @default(uuid()) @db.Uuid
  
  // COUPON DETAILS
  code                    String    @unique @db.VarChar(50)
  name                    String    @db.VarChar(255)
  description             String?   @db.Text
  
  // DISCOUNT TYPE & VALUE
  discountType            String    @db.VarChar(20)
  discountValue           Decimal   @db.Decimal(10, 2)
  maxDiscountAmount       Decimal?  @db.Decimal(10, 2)
  minOrderAmount          Decimal?  @db.Decimal(10, 2)
  
  // VALIDITY
  validFrom               DateTime  @db.Date
  validTo                 DateTime  @db.Date
  isActive                Boolean   @default(true)
  
  // USAGE LIMITS
  totalUsageLimit         Int?
  usageCount              Int       @default(0)
  perUserLimit            Int       @default(1)
  
  // APPLICABILITY
  applicableFor           Json?
  treatmentTypes          Json?
  hospitalIds             Json?
  countryIds              Json?
  userTypes               Json?
  
  // RESTRICTIONS
  excludedTreatments      Json?
  excludedHospitals       Json?
  firstTimeUsersOnly      Boolean   @default(false)
  
  // METADATA
  createdBy               String?   @db.Uuid
  tags                    Json?
  notes                   String?   @db.Text
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@index([code])
  @@index([validFrom, validTo])
  @@index([isActive])
  @@map("coupons")
}

model DNAKit {
  dnaKitId                String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  patientId               String    @db.Uuid
  orderedBy               String?   @db.Uuid
  
  // KIT DETAILS
  kitNumber               String    @unique @db.VarChar(100)
  kitType                 String    @db.VarChar(100)
  kitName                 String    @db.VarChar(255)
  manufacturer            String?   @db.VarChar(255)
  
  // ORDER STATUS
  status                  String    @default("ordered") @db.VarChar(50)
  orderedAt               DateTime  @default(now())
  shippedAt               DateTime?
  deliveredAt             DateTime?
  sampleCollectedAt       DateTime?
  receivedAtLabAt         DateTime?
  resultsReadyAt          DateTime?
  
  // SHIPPING
  trackingNumber          String?   @db.VarChar(100)
  shippingCarrier         String?   @db.VarChar(100)
  shippingAddress         String?   @db.Text
  
  // SAMPLE DETAILS
  sampleType              String?   @db.VarChar(100)
  sampleId                String?   @db.VarChar(100)
  sampleQuality           String?   @db.VarChar(50)
  sampleNotes             String?   @db.Text
  
  // TESTING
  testType                String?   @db.VarChar(255)
  testsIncluded           Json?
  laboratoryName          String?   @db.VarChar(255)
  labTechnician           String?   @db.VarChar(255)
  
  // RESULTS
  resultsUrl              String?   @db.VarChar(500)
  resultsDocument         String?   @db.VarChar(500)
  resultsSummary          String?   @db.Text
  findings                Json?
  recommendations         String?   @db.Text
  
  // GENETIC INFO
  geneticMarkers          Json?
  riskFactors             Json?
  healthInsights          Json?
  ancestryInfo            Json?
  
  // PRIVACY
  consentGiven            Boolean   @default(false)
  consentDate             DateTime?
  dataSharing             Boolean   @default(false)
  anonymized              Boolean   @default(false)
  
  // PRICING
  kitPrice                Decimal   @db.Decimal(10, 2)
  shippingFee             Decimal   @default(0) @db.Decimal(10, 2)
  totalPrice              Decimal   @db.Decimal(10, 2)
  currency                String    @default("USD") @db.VarChar(3)
  isPaid                  Boolean   @default(false)
  paymentId               String?   @db.Uuid
  
  // NOTES
  notes                   String?   @db.Text
  internalNotes           String?   @db.Text
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  laboratoryId            String?   @db.Uuid
  laboratory              Laboratory? @relation(fields: [laboratoryId], references: [laboratoryId], onDelete: SetNull)
  
  @@index([patientId])
  @@index([kitNumber])
  @@index([status])
  @@map("dna_kits")
}

model Department {
  departmentId            String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  hospitalId              String    @db.Uuid
  
  // DEPARTMENT DETAILS
  departmentName          String    @db.VarChar(255)
  departmentCode          String?   @db.VarChar(50)
  departmentType          String?   @db.VarChar(100)
  
  // DESCRIPTION
  description             String?   @db.Text
  shortDescription        String?   @db.VarChar(500)
  services                Json?
  specializations         Json?
  
  // FACILITIES
  bedCount                Int       @default(0)
  icuBeds                 Int       @default(0)
  emergencyBeds           Int       @default(0)
  facilities              Json?
  equipment               Json?
  
  // STAFF
  headOfDepartment        String?   @db.Uuid
  doctorCount             Int       @default(0)
  nurseCount              Int       @default(0)
  staffCount              Int       @default(0)
  
  // CONTACT
  phone                   String?   @db.VarChar(20)
  email                   String?   @db.VarChar(255)
  extension               String?   @db.VarChar(10)
  location                String?   @db.VarChar(255)
  floor                   String?   @db.VarChar(50)
  
  // OPERATIONAL
  isEmergency             Boolean   @default(false)
  is24x7                  Boolean   @default(false)
  workingHours            Json?
  
  // STATISTICS
  averageWaitTime         Int?
  treatmentCount          Int       @default(0)
  successRate             Decimal?  @db.Decimal(5, 2)
  
  // METADATA
  isActive                Boolean   @default(true)
  displayOrder            Int       @default(0)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  hospital                Hospital  @relation(fields: [hospitalId], references: [hospitalId], onDelete: Cascade)
  appointments            Appointment[]
  bookings                Booking[]
  
  @@index([hospitalId])
  @@index([departmentName])
  @@index([isActive])
  @@map("departments")
}

model Device {
  deviceId                String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String    @db.Uuid
  
  // DEVICE DETAILS
  deviceName              String?   @db.VarChar(255)
  deviceType              String?   @db.VarChar(50)
  deviceModel             String?   @db.VarChar(100)
  browser                 String?   @db.VarChar(100)
  browserVersion          String?   @db.VarChar(50)
  os                      String?   @db.VarChar(100)
  osVersion               String?   @db.VarChar(50)
  
  // NETWORK
  ipAddress               String?   @db.VarChar(45)
  location                String?   @db.VarChar(255)
  city                    String?   @db.VarChar(100)
  country                 String?   @db.VarChar(100)
  
  // DEVICE FINGERPRINT
  fingerprint             String?   @unique @db.VarChar(500)
  userAgent               String?   @db.Text
  screenResolution        String?   @db.VarChar(50)
  timezone                String?   @db.VarChar(100)
  language                String?   @db.VarChar(50)
  
  // SECURITY
  isTrusted               Boolean   @default(false)
  trustLevel              String?   @default("low") @db.VarChar(20)
  isBlocked               Boolean   @default(false)
  blockedAt               DateTime?
  blockedReason           String?   @db.Text
  
  // USAGE
  firstUsedAt             DateTime  @default(now())
  lastUsedAt              DateTime  @default(now())
  usageCount              Int       @default(1)
  
  // NOTIFICATIONS
  pushToken               String?   @db.VarChar(500)
  notificationsEnabled    Boolean   @default(false)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  sessions                Session[]
  
  @@index([userId])
  @@index([isTrusted])
  @@index([fingerprint])
  @@map("devices")
}

model Doctor {
  doctorId                String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String    @unique @db.Uuid
  hospitalId              String?   @db.Uuid
  departmentId            String?   @db.Uuid
  specializationId        String?   @db.Uuid
  
  // PROFESSIONAL DETAILS (rest unchanged)
  medicalLicenseNumber    String?   @unique @db.VarChar(100)
  licenseIssuingAuthority String?   @db.VarChar(255)
  licenseIssueDate        DateTime? @db.Date
  licenseExpiryDate       DateTime? @db.Date
  
  qualifications          Json?
  degree                  String?   @db.VarChar(255)
  medicalSchool           String?   @db.VarChar(255)
  graduationYear          Int?
  certifications          Json?
  
  primarySpecialization   String?   @db.VarChar(255)
  secondarySpecializations Json?
  areasOfExpertise        Json?
  treatmentTypes          Json?
  
  experienceYears         Int?
  previousWorkplaces      Json?
  currentHospital         String?   @db.VarChar(255)
  departmentName          String?   @db.VarChar(255)
  
  consultationFee         Decimal?  @db.Decimal(10, 2)
  followUpFee             Decimal?  @db.Decimal(10, 2)
  emergencyFee            Decimal?  @db.Decimal(10, 2)
  currency                String    @default("USD") @db.VarChar(3)
  consultationDuration    Int       @default(30)
  
  availability            Json?
  workingDays             Json?
  workingHours            Json?
  timeZone                String?   @db.VarChar(100)
  acceptsEmergencies      Boolean   @default(false)
  acceptsNewPatients      Boolean   @default(true)
  
  languagesSpoken         Json?
  primaryLanguage         String?   @db.VarChar(100)
  
  bio                     String?   @db.Text
  shortBio                String?   @db.VarChar(500)
  achievements            Json?
  awards                  Json?
  publications            Json?
  research                Json?
  
  rating                  Decimal?  @db.Decimal(3, 2)
  totalReviews            Int       @default(0)
  ratingBreakdown         Json?
  
  totalConsultations      Int       @default(0)
  totalPatients           Int       @default(0)
  successRate             Decimal?  @db.Decimal(5, 2)
  averageWaitTime         Int?
  
  clinicPhone             String?   @db.VarChar(20)
  clinicEmail             String?   @db.VarChar(255)
  clinicAddress           String?   @db.Text
  
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  verifiedBy              String?   @db.Uuid
  verificationDocuments   Json?
  
  status                  String    @default("active") @db.VarChar(50)
  availabilityStatus      String?   @default("available") @db.VarChar(50)
  isAcceptingAppointments Boolean   @default(true)
  
  medicalCouncilRegistration String? @db.VarChar(100)
  councilName             String?   @db.VarChar(255)
  registrationYear        Int?
  
  insuranceAccepted       Json?
  insuranceProviders      Json?
  
  profileImage            String?   @db.VarChar(500)
  clinicImages            Json?
  videoIntro              String?   @db.VarChar(500)
  
  slug                    String?   @unique @db.VarChar(255)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  specialization          Specialization? @relation(fields: [specializationId], references: [specializationId], onDelete: SetNull)
  
  expertCalls             ExpertCall[]
  appointments            Appointment[]
  consultations           Consultation[]
  prescriptions           Prescription[]
  schedules               DoctorSchedule[]
  
  @@index([userId])
  @@index([hospitalId])
  @@index([specializationId])
  @@index([status])
  @@index([isVerified])
  @@index([slug])
  @@map("doctors")
}

model DoctorSchedule {
  scheduleId              String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  doctorId                String    @db.Uuid
  hospitalId              String?   @db.Uuid
  
  // SCHEDULE DETAILS
  dayOfWeek               Int
  startTime               DateTime  @db.Time
  endTime                 DateTime  @db.Time
  slotDuration            Int       @default(30)
  
  // CAPACITY
  maxPatients             Int       @default(20)
  currentBookings         Int       @default(0)
  
  // AVAILABILITY
  isAvailable             Boolean   @default(true)
  isRecurring             Boolean   @default(true)
  effectiveFrom           DateTime  @db.Date
  effectiveTo             DateTime? @db.Date
  
  // CONSULTATION TYPE
  consultationType        String    @default("in-person") @db.VarChar(50)
  allowsOnlineConsultation Boolean  @default(true)
  allowsInPersonConsultation Boolean @default(true)
  
  // BREAKS
  breakStartTime          DateTime? @db.Time
  breakEndTime            DateTime? @db.Time
  hasBreak                Boolean   @default(false)
  
  // LOCATION
  location                String?   @db.VarChar(255)
  roomNumber              String?   @db.VarChar(50)
  
  // EXCEPTIONS
  holidayDates            Json?
  blockedDates            Json?
  
  // NOTES
  notes                   String?   @db.Text
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  doctor                  Doctor    @relation(fields: [doctorId], references: [doctorId], onDelete: Cascade)
  
  @@index([doctorId])
  @@index([dayOfWeek])
  @@index([isAvailable])
  @@map("doctor_schedules")
}

model Document {
  documentId              String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String    @db.Uuid
  bookingId               String?   @db.Uuid
  patientId               String?   @db.Uuid
  
  // DOCUMENT DETAILS
  documentName            String    @db.VarChar(255)
  documentType            String    @db.VarChar(100)
  documentCategory        String?   @db.VarChar(100)
  description             String?   @db.Text
  
  // FILE INFO
  fileName                String    @db.VarChar(255)
  fileUrl                 String    @db.VarChar(500)
  fileSize                BigInt
  fileSizeReadable        String?   @db.VarChar(50)
  fileType                String    @db.VarChar(100)
  mimeType                String?   @db.VarChar(100)
  
  // STORAGE
  storageProvider         String?   @default("imagekit") @db.VarChar(50)
  storageKey              String?   @db.VarChar(500)
  storageBucket           String?   @db.VarChar(255)
  thumbnailUrl            String?   @db.VarChar(500)
  
  // DOCUMENT METADATA
  documentDate            DateTime? @db.Date
  expiryDate              DateTime? @db.Date
  documentNumber          String?   @db.VarChar(100)
  issuedBy                String?   @db.VarChar(255)
  issuedDate              DateTime? @db.Date
  
  // VERIFICATION
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  verifiedBy              String?   @db.Uuid
  verificationNotes       String?   @db.Text
  
  // ACCESS CONTROL
  isPublic                Boolean   @default(false)
  isConfidential          Boolean   @default(false)
  accessLevel             String?   @default("private") @db.VarChar(50)
  sharedWith              Json?
  
  // STATUS
  status                  String    @default("active") @db.VarChar(50)
  uploadStatus            String?   @default("completed") @db.VarChar(50)
  
  // VERSIONING
  version                 Int       @default(1)
  previousVersionId       String?   @db.Uuid
  
  // OCR & PROCESSING
  isProcessed             Boolean   @default(false)
  processedAt             DateTime?
  extractedText           String?   @db.Text
  extractedData           Json?
  
  // TAGS & NOTES
  tags                    Json?
  notes                   String?   @db.Text
  internalNotes           String?   @db.Text
  
  // DOWNLOAD TRACKING
  downloadCount           Int       @default(0)
  lastDownloadedAt        DateTime?
  
  uploadedAt              DateTime  @default(now())
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  booking                 Booking?  @relation(fields: [bookingId], references: [bookingId], onDelete: SetNull)
  
  @@index([userId])
  @@index([bookingId])
  @@index([documentType])
  @@index([status])
  @@index([isVerified])
  @@map("documents")
}

model EmailConfirmation {
  confirmationId          String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String    @db.Uuid
  
  // EMAIL DETAILS
  email                   String    @db.VarChar(255)
  emailType               String?   @default("verification") @db.VarChar(50)
  
  // TOKEN
  token                   String    @unique @db.VarChar(500)
  tokenHash               String?   @db.VarChar(500)
  
  // VALIDITY
  expiresAt               DateTime
  confirmedAt             DateTime?
  
  // ATTEMPTS
  verificationAttempts    Int       @default(0)
  lastAttemptAt           DateTime?
  
  // RESEND
  resendCount             Int       @default(0)
  lastResentAt            DateTime?
  
  // STATUS
  status                  String    @default("pending") @db.VarChar(50)
  
  // METADATA
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  
  @@index([userId])
  @@index([token])
  @@index([email])
  @@index([expiresAt])
  @@index([status])
  @@map("email_confirmations")
}

model EmailLog {
  emailLogId              String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  userId                  String?   @db.Uuid
  
  // EMAIL DETAILS
  toEmail                 String    @db.VarChar(255)
  fromEmail               String    @db.VarChar(255)
  ccEmails                Json?
  bccEmails               Json?
  
  // CONTENT
  subject                 String    @db.VarChar(500)
  body                    String    @db.Text
  htmlBody                String?   @db.Text
  templateName            String?   @db.VarChar(100)
  templateVariables       Json?
  
  // ATTACHMENTS
  attachments             Json?
  attachmentCount         Int       @default(0)
  
  // STATUS
  status                  String    @default("pending") @db.VarChar(50)
  sentAt                  DateTime?
  deliveredAt             DateTime?
  openedAt                DateTime?
  clickedAt               DateTime?
  bouncedAt               DateTime?
  
  // TRACKING
  messageId               String?   @unique @db.VarChar(255)
  externalId              String?   @db.VarChar(255)
  provider                String?   @default("smtp") @db.VarChar(50)
  
  // DELIVERY INFO
  deliveryAttempts        Int       @default(0)
  lastAttemptAt           DateTime?
  errorMessage            String?   @db.Text
  errorCode               String?   @db.VarChar(50)
  
  // ENGAGEMENT
  openCount               Int       @default(0)
  clickCount              Int       @default(0)
  
  // METADATA
  category                String?   @db.VarChar(100)
  tags                    Json?
  priority                String?   @default("normal") @db.VarChar(20)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User?     @relation(fields: [userId], references: [userId], onDelete: SetNull)
  
  @@index([userId])
  @@index([toEmail])
  @@index([status])
  @@index([createdAt])
  @@map("email_logs")
}

model ExpertCall {
  callId                  String    @id @default(uuid()) @db.Uuid
  bookingId               String    @db.Uuid
  expertId                String?   @db.Uuid
  scheduledAt             DateTime?
  scheduleTime            String?   @db.VarChar(50)
  scheduleTimeZone        String?   @db.VarChar(50)
  estimatedDuration       Int       @default(30)
  remindedAt              DateTime?
  startedAt               DateTime?
  completedAt             DateTime?
  status                  String    @default("pending") @db.VarChar(50)
  callType                String    @default("video") @db.VarChar(50)
  actualDuration          Int?
  meetingLink             String?   @db.VarChar(500)
  phoneNumber             String?   @db.VarChar(20)
  phonePin                String?   @db.VarChar(50)
  recordingUrl            String?   @db.VarChar(500)
  recordingConsent        Boolean   @default(false)
  notes                   String?   @db.Text
  expertNotes             String?   @db.Text
  patientFeedback         String?   @db.Text
  findings                Json?
  diagnosis               String?   @db.Text
  recommendations         Json?
  nextSteps               Json?
  prescriptions           Json?
  testsRecommended        Json?
  attachments             Json?
  followUpRequired        Boolean   @default(false)
  followUpDate            DateTime?
  followUpType            String?   @db.VarChar(50)
  cancellationReason      String?   @db.Text
  cancelledAt             DateTime?
  cancelledBy             String?   @db.VarChar(50)
  rescheduledFrom         String?   @db.Uuid
  noShowReason            String?   @db.Text
  patientResponded        Boolean   @default(false)
  automaticReschedule     Boolean   @default(false)
  expertRating            Decimal?  @db.Decimal(3, 2)
  patientRating           Decimal?  @db.Decimal(3, 2)
  patientReview           String?   @db.Text
  ipAddress               String?   @db.VarChar(45)
  deviceInfo              Json?
  reminderId              String?   @db.Uuid
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  expert                  Doctor?   @relation(fields: [expertId], references: [doctorId], onDelete: SetNull)
  userId                  String?   @db.Uuid
  user                    User?     @relation(fields: [userId], references: [userId], onDelete: SetNull)

  @@index([bookingId])
  @@index([expertId])
  @@index([status])
  @@index([scheduledAt])
  @@map("expert_calls")
}

model FAQ {
  faqId                   String    @id @default(uuid()) @db.Uuid
  
  // QUESTION & ANSWER
  question                String    @db.Text
  answer                  String    @db.Text
  shortAnswer             String?   @db.VarChar(500)
  
  // CATEGORIZATION
  category                String    @db.VarChar(100)
  subcategory             String?   @db.VarChar(100)
  tags                    Json?
  
  // RELEVANCE
  relatedTo               String?   @db.VarChar(100)
  treatmentId             String?   @db.Uuid
  hospitalId              String?   @db.Uuid
  countryId               String?   @db.Uuid
  
  // METADATA
  displayOrder            Int       @default(0)
  isActive                Boolean   @default(true)
  isFeatured              Boolean   @default(false)
  
  // ENGAGEMENT
  viewCount               Int       @default(0)
  helpfulCount            Int       @default(0)
  notHelpfulCount         Int       @default(0)
  
  // AUTHORING
  createdBy               String?   @db.Uuid
  lastEditedBy            String?   @db.Uuid
  lastEditedAt            DateTime?
  
  // SEO
  slug                    String?   @unique @db.VarChar(255)
  metaTitle               String?   @db.VarChar(255)
  metaDescription         String?   @db.VarChar(500)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  votes                   FAQVote[]
  
  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@index([slug])
  @@map("faqs")
}

model FAQVote {
  voteId                  String    @id @default(uuid()) @db.Uuid
  faqId                   String    @db.Uuid
  userId                  String?   @db.Uuid
  voteType                String    @db.VarChar(20)
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  createdAt               DateTime  @default(now())
  
  faq                     FAQ       @relation(fields: [faqId], references: [faqId], onDelete: Cascade)
  
  @@unique([faqId, userId])
  @@unique([faqId, ipAddress])
  @@index([faqId])
  @@index([userId])
  @@map("faq_votes")
}

model FamilyMember {
  familyMemberId          String    @id @default(uuid()) @db.Uuid
  primaryUserId           String    @db.Uuid
  patientId               String?   @unique @db.Uuid
  firstName               String    @db.VarChar(100)
  lastName                String    @db.VarChar(100)
  relationship            String    @db.VarChar(50)
  dateOfBirth             DateTime? @db.Date
  age                     Int?
  gender                  String?   @db.VarChar(20)
  bloodType               String?   @db.VarChar(10)
  phone                   String?   @db.VarChar(20)
  email                   String?   @db.VarChar(255)
  allergies               Json?
  chronicConditions       Json?
  currentMedications      Json?
  medicalHistory          Json?
  disabilities            Json?
  profilePicture          String?   @db.VarChar(500)
  idProof                 String?   @db.VarChar(500)
  medicalDocuments        Json?
  canBookTreatment        Boolean   @default(true)
  isEmergencyContact      Boolean   @default(false)
  requiresGuardianConsent Boolean   @default(false)
  isActive                Boolean   @default(true)
  isVerified              Boolean   @default(false)
  notes                   String?   @db.Text
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  primaryUser             User      @relation(fields: [primaryUserId], references: [userId], onDelete: Cascade)
  patient                 Patient?  @relation(fields: [patientId], references: [patientId], onDelete: SetNull)
  
  @@index([primaryUserId])
  @@index([patientId])
  @@index([isActive])
  @@map("family_members")
}

model FeatureAddOn {
  addOnId                 String    @id @default(uuid()) @db.Uuid
  name                    String    @db.VarChar(255)
  code                    String?   @unique @db.VarChar(50)
  description             String?   @db.Text
  shortDescription        String?   @db.VarChar(500)
  category                String?   @db.VarChar(100)
  type                    String    @db.VarChar(50)
  price                   Decimal   @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  isActive                Boolean   @default(true)
  isFeatured              Boolean   @default(false)
  isPopular               Boolean   @default(false)
  availability            String    @default("always") @db.VarChar(50)
  maxQuantity             Int?
  duration                Int?
  durationUnit            String?   @db.VarChar(20)
  icon                    String?   @db.VarChar(255)
  imageUrl                String?   @db.VarChar(500)
  inclusions              Json?
  restrictions            Json?
  terms                   String?   @db.Text
  displayOrder            Int       @default(0)
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  bookingAddOns           BookingAddOn[]
  
  @@index([code])
  @@index([isActive])
  @@index([category])
  @@map("feature_addons")
}

model Flight {
  flightId                String    @id @default(uuid()) @db.Uuid
  bookingId               String    @db.Uuid
  userId                  String    @db.Uuid
  flightType              String    @db.VarChar(50)
  flightNumber            String?   @db.VarChar(50)
  airline                 String?   @db.VarChar(255)
  departureAirport        String    @db.VarChar(100)
  departureAirportCode    String?   @db.VarChar(10)
  arrivalAirport          String    @db.VarChar(100)
  arrivalAirportCode      String?   @db.VarChar(10)
  departureDate           DateTime  @db.Date
  departureTime           String?   @db.VarChar(20)
  arrivalDate             DateTime? @db.Date
  arrivalTime             String?   @db.VarChar(20)
  duration                Int?
  class                   String?   @db.VarChar(50)
  seatNumber              String?   @db.VarChar(20)
  bookingReference        String?   @db.VarChar(100)
  pnr                     String?   @db.VarChar(100)
  price                   Decimal?  @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  status                  String    @default("pending") @db.VarChar(50)
  ticketUrl               String?   @db.VarChar(500)
  eTicketNumber           String?   @db.VarChar(100)
  baggageAllowance        String?   @db.VarChar(100)
  specialRequests         String?   @db.Text
  passengerName           String?   @db.VarChar(255)
  passengerEmail          String?   @db.VarChar(255)
  passengerPhone          String?   @db.VarChar(20)
  checkInUrl              String?   @db.VarChar(500)
  boardingPass            String?   @db.VarChar(500)
  cancelledAt             DateTime?
  cancellationReason      String?   @db.Text
  refundAmount            Decimal?  @db.Decimal(12, 2)
  notes                   String?   @db.Text
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  
  @@index([bookingId])
  @@index([userId])
  @@index([status])
  @@index([departureDate])
  @@map("flights")
}

model GoogleMeetIntegration {
  meetingId               String    @id @default(uuid()) @db.Uuid
  appointmentId           String?   @db.Uuid
  consultationId          String?   @db.Uuid
  expertCallId            String?   @db.Uuid
  userId                  String    @db.Uuid
  meetLink                String    @db.VarChar(500)
  meetingCode             String?   @db.VarChar(50)
  scheduledStartTime      DateTime
  scheduledEndTime        DateTime?
  actualStartTime         DateTime?
  actualEndTime           DateTime?
  duration                Int?
  status                  String    @default("scheduled") @db.VarChar(50)
  hostUserId              String?   @db.Uuid
  participantIds          Json?
  recordingUrl            String?   @db.VarChar(500)
  recordingConsent        Boolean   @default(false)
  transcriptUrl           String?   @db.VarChar(500)
  calendarEventId         String?   @db.VarChar(255)
  googleCredentials       Json?
  refreshToken            String?   @db.Text
  accessToken             String?   @db.Text
  tokenExpiresAt          DateTime?
  notes                   String?   @db.Text
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@index([appointmentId])
  @@index([consultationId])
  @@index([expertCallId])
  @@index([userId])
  @@index([status])
  @@map("google_meet_integrations")
}

model Hospital {
  hospitalId              String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS
  countryId               String    @db.Uuid
  cityId                  String    @db.Uuid
  
  // HOSPITAL DETAILS
  hospitalName            String    @db.VarChar(255)
  hospitalType            String?   @db.VarChar(100)
  establishedYear         Int?
  registrationNumber      String?   @db.VarChar(100)
  
  // ACCREDITATION
  accreditations          Json?
  certifications          Json?
  awards                  Json?
  isJCIAccredited         Boolean   @default(false)
  isNABHAccredited        Boolean   @default(false)
  
  // CONTACT
  phone                   String?   @db.VarChar(20)
  alternatePhone          String?   @db.VarChar(20)
  email                   String?   @db.VarChar(255)
  website                 String?   @db.VarChar(255)
  fax                     String?   @db.VarChar(20)
  
  // ADDRESS
  address                 String    @db.Text
  street                  String?   @db.VarChar(255)
  city                    String?   @db.VarChar(100) // Keep as scalar string, rename if you have relation below
  state                   String?   @db.VarChar(100)
  postalCode              String?   @db.VarChar(20)
  landmark                String?   @db.VarChar(255)
  
  // GEOGRAPHIC
  latitude                Decimal?  @db.Decimal(10, 8)
  longitude               Decimal?  @db.Decimal(11, 8)
  timezone                String?   @db.VarChar(100)
  
  // DESCRIPTION
  description             String?   @db.Text
  shortDescription        String?   @db.VarChar(500)
  missionStatement        String?   @db.Text
  visionStatement         String?   @db.Text
  
  // FACILITIES
  bedCount                Int       @default(0)
  icuBeds                 Int       @default(0)
  emergencyBeds           Int       @default(0)
  operationTheaters       Int       @default(0)
  totalArea               Decimal?  @db.Decimal(10, 2)
  parkingSpaces           Int       @default(0)
  
  // AMENITIES
  amenities               Json?
  facilities              Json?
  equipment               Json?
  technologies            Json?
  
  // DEPARTMENTS
  departments             Department[]
  specialties             Json?
  centerOfExcellence      Json?
  
  // STAFF
  totalDoctors            Int       @default(0)
  totalNurses             Int       @default(0)
  totalStaff              Int       @default(0)
  internationalPatientCoordinator Boolean @default(false)
  
  // SERVICES
  services                Json?
  emergencyServices       Boolean   @default(true)
  ambulanceService        Boolean   @default(true)
  pharmacyService         Boolean   @default(true)
  labService              Boolean   @default(true)
  bloodBank               Boolean   @default(false)
  diagnosticCenter        Boolean   @default(true)
  
  // INTERNATIONAL PATIENTS
  acceptsInternationalPatients Boolean @default(true)
  languagesSupported      Json?
  interpreterService      Boolean   @default(false)
  visaAssistance          Boolean   @default(false)
  airportPickup           Boolean   @default(false)
  accommodationAssistance Boolean   @default(false)
  
  // INSURANCE
  insuranceAccepted       Json?
  cashlessInsurance       Boolean   @default(false)
  
  // PAYMENT
  paymentMethods          Json?
  acceptsCreditCard       Boolean   @default(true)
  acceptsInternationalCards Boolean @default(true)
  currenciesAccepted      Json?
  
  // WORKING HOURS
  workingHours            Json?
  emergencyHours          String?   @db.VarChar(100)
  isOpen24x7              Boolean   @default(false)
  
  // RATINGS & REVIEWS
  rating                  Decimal?  @db.Decimal(3, 2)
  totalReviews            Int       @default(0)
  ratingBreakdown         Json?
  
  // STATISTICS
  totalTreatments         Int       @default(0)
  successRate             Decimal?  @db.Decimal(5, 2)
  patientSatisfaction     Decimal?  @db.Decimal(5, 2)
  averageCostSaving       Decimal?  @db.Decimal(5, 2)
  
  // MEDIA
  logo                    String?   @db.VarChar(500)
  images                  Json?
  videos                  Json?
  virtualTour             String?   @db.VarChar(500)
  
  // SOCIAL MEDIA
  facebookUrl             String?   @db.VarChar(255)
  twitterUrl              String?   @db.VarChar(255)
  instagramUrl            String?   @db.VarChar(255)
  linkedinUrl             String?   @db.VarChar(255)
  youtubeUrl              String?   @db.VarChar(255)
  
  // SEO
  slug                    String    @unique @db.VarChar(255)
  metaTitle               String?   @db.VarChar(255)
  metaDescription         String?   @db.VarChar(500)
  metaKeywords            String?   @db.VarChar(500)
  
  // VERIFICATION
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  verifiedBy              String?   @db.Uuid
  
  // STATUS
  isActive                Boolean   @default(true)
  isFeatured              Boolean   @default(false)
  displayOrder            Int       @default(0)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  country                 Country   @relation(fields: [countryId], references: [countryId], onDelete: Cascade)
  cityRel                 City      @relation(fields: [cityId], references: [cityId], onDelete: Cascade)

  bookings                Booking[]
  appointments            Appointment[]
  consultations           Consultation[]
  accommodations          Accommodation[]
  invoices                Invoice[]
  laboratories            Laboratory[]
  packages                Package[]
  
  @@index([countryId])
  @@index([cityId])
  @@index([slug])
  @@index([isActive])
  @@index([isFeatured])
  @@index([isVerified])
  @@map("hospitals")
}

model Immunization {
  immunizationId          String    @id @default(uuid()) @db.Uuid
  patientId               String    @db.Uuid
  vaccineName             String    @db.VarChar(255)
  vaccineType             String?   @db.VarChar(100)
  manufacturer            String?   @db.VarChar(255)
  batchNumber             String?   @db.VarChar(100)
  lotNumber               String?   @db.VarChar(100)
  administeredDate        DateTime  @db.Date
  administeredBy          String?   @db.VarChar(255)
  administrationSite      String?   @db.VarChar(100)
  routeOfAdministration   String?   @db.VarChar(100)
  dosage                  String?   @db.VarChar(100)
  doseNumber              Int?
  totalDosesRequired      Int?
  facilityName            String?   @db.VarChar(255)
  facilityAddress         String?   @db.Text
  nextDoseDate            DateTime? @db.Date
  nextDoseReminder        Boolean   @default(false)
  reminderSentAt          DateTime?
  adverseReaction         Boolean   @default(false)
  reactionDetails         String?   @db.Text
  reactionSeverity        String?   @db.VarChar(50)
  certificateNumber       String?   @db.VarChar(100)
  certificateUrl          String?   @db.VarChar(500)
  documentUrl             String?   @db.VarChar(500)
  validFrom               DateTime? @db.Date
  validUntil              DateTime? @db.Date
  isValid                 Boolean   @default(true)
  notes                   String?   @db.Text
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  
  @@index([patientId])
  @@index([administeredDate])
  @@index([vaccineName])
  @@map("immunizations")
}

model Insurance {
  insuranceId             String    @id @default(uuid()) @db.Uuid
  
  // RELATIONSHIPS  
  userId                  String    @db.Uuid
  patientId               String?   @db.Uuid
  
  // INSURANCE PROVIDER
  providerName            String    @db.VarChar(255)
  providerCode            String?   @db.VarChar(100)
  providerPhone           String?   @db.VarChar(20)
  providerEmail           String?   @db.VarChar(255)
  providerWebsite         String?   @db.VarChar(255)
  
  // POLICY DETAILS
  policyNumber            String    @unique @db.VarChar(100)
  policyType              String    @db.VarChar(100)
  policyName              String?   @db.VarChar(255)
  groupNumber             String?   @db.VarChar(100)
  
  // HOLDER DETAILS
  policyHolderName        String    @db.VarChar(255)
  policyHolderRelation    String?   @db.VarChar(50)
  policyHolderDOB         DateTime? @db.Date
  
  // COVERAGE
  coverageType            String?   @db.VarChar(100)
  coverageAmount          Decimal?  @db.Decimal(12, 2)
  deductible              Decimal?  @db.Decimal(10, 2)
  copay                   Decimal?  @db.Decimal(10, 2)
  coinsurance             Decimal?  @db.Decimal(5, 2)
  outOfPocketMax          Decimal?  @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  
  // COVERAGE DETAILS
  coverageDetails         Json?
  coveredServices         Json?
  excludedServices        Json?
  limitations             Json?
  
  // VALIDITY
  startDate               DateTime  @db.Date
  endDate                 DateTime  @db.Date
  isActive                Boolean   @default(true)
  renewalDate             DateTime? @db.Date
  
  // NETWORK
  networkType             String?   @db.VarChar(50)
  networkProviders        Json?
  isInNetwork             Boolean   @default(true)
  
  // AUTHORIZATION
  requiresPreAuth         Boolean   @default(false)
  preAuthNumber           String?   @db.VarChar(100)
  preAuthDate             DateTime?
  preAuthExpiry           DateTime?
  
  // CLAIM INFORMATION
  claimAddress            String?   @db.Text
  claimPhone              String?   @db.VarChar(20)
  claimEmail              String?   @db.VarChar(255)
  claimSubmissionMethod   String?   @db.VarChar(50)
  
  // VERIFICATION
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  verifiedBy              String?   @db.Uuid
  verificationNotes       String?   @db.Text
  lastVerificationDate    DateTime?
  
  // DOCUMENTS
  insuranceCardFront      String?   @db.VarChar(500)
  insuranceCardBack       String?   @db.VarChar(500)
  policyDocument          String?   @db.VarChar(500)
  
  // CONTACT
  memberServicePhone      String?   @db.VarChar(20)
  memberServiceEmail      String?   @db.VarChar(255)
  
  // NOTES
  notes                   String?   @db.Text
  internalNotes           String?   @db.Text
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // RELATIONS
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  documents               InsuranceDocument[]
  
  @@index([userId])
  @@index([policyNumber])
  @@index([isActive])
  @@index([isVerified])
  @@map("insurances")
}

model InsuranceDocument {
  id                      Int       @id @default(autoincrement())
  bookingId               String    @db.Uuid
  patientId               String    @db.Uuid
  insuranceProviderName   String    @db.VarChar(255)
  policyNumber            String    @db.VarChar(255)
  groupNumber             String?   @db.VarChar(255)
  memberId                String?   @db.VarChar(255)
  coverageType            String    @default("partial") @db.VarChar(50)
  coverageAmount          Decimal?  @db.Decimal(12, 2)
  deductible              Decimal?  @db.Decimal(12, 2)
  coInsurancePercentage   Decimal?  @db.Decimal(5, 2)
  documentUrl             String    @db.VarChar(500)
  documentType            String    @db.VarChar(100)
  fileName                String    @db.VarChar(255)
  fileSize                Int?
  fileId                  String?   @db.VarChar(255)
  validFrom               DateTime? @db.Date
  validTo                 DateTime? @db.Date
  verificationStatus      String    @default("pending") @db.VarChar(50)
  verificationNotes       String?   @db.Text
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")
  
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  // Patient relation (patientId scalar exists)
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  // Optional link to Insurance
  insuranceId             String?   @db.Uuid
  insurance               Insurance? @relation(fields: [insuranceId], references: [insuranceId], onDelete: SetNull)
  
  @@index([bookingId])
  @@index([patientId])
  @@map("insurance_documents")
}

model Invoice {
  invoiceId               String    @id @default(uuid()) @db.Uuid
  bookingId               String    @db.Uuid
  userId                  String    @db.Uuid
  hospitalId              String?   @db.Uuid
  paymentId               Int?      // changed to Int? to match Payment.id type
  invoiceNumber           String    @unique @db.VarChar(255)
  invoiceDate             DateTime  @db.Date
  dueDate                 DateTime? @db.Date
  status                  String    @default("draft") @db.VarChar(50)
  type                    String    @default("invoice") @db.VarChar(50)
  billTo                  Json
  shipTo                  Json?
  billFrom                Json?
  lineItems               Json
  itemCount               Int       @default(0)
  subtotal                Decimal   @db.Decimal(12, 2)
  taxable                 Decimal?  @db.Decimal(12, 2)
  discount                Decimal   @default(0) @db.Decimal(10, 2)
  discountPercentage      Decimal?  @db.Decimal(5, 2)
  discountReason          String?   @db.VarChar(255)
  taxAmount               Decimal   @default(0) @db.Decimal(10, 2)
  taxRate                 Decimal?  @db.Decimal(5, 2)
  shippingCharges         Decimal   @default(0) @db.Decimal(10, 2)
  otherCharges            Decimal   @default(0) @db.Decimal(10, 2)
  totalAmount             Decimal   @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  amountPaid              Decimal   @default(0) @db.Decimal(12, 2)
  amountDue               Decimal?  @db.Decimal(12, 2)
  paymentTerms            String    @default("immediate") @db.VarChar(50)
  paymentMethod           String?   @db.VarChar(50)
  paymentDueDate          DateTime? @db.Date
  sentAt                  DateTime?
  viewedAt                DateTime?
  paidAt                  DateTime?
  notes                   String?   @db.Text
  internalNotes           String?   @db.Text
  purchaseOrderNumber     String?   @db.VarChar(255)
  referenceNumber         String?   @db.VarChar(255)
  terms                   String?   @db.Text
  taxId                   String?   @db.VarChar(255)
  hsn                     Json?
  gst                     Json?
  invoicePdf              String?   @db.VarChar(500)
  attachment              String?   @db.VarChar(500)
  receipt                 String?   @db.VarChar(500)
  createdBy               String?   @db.Uuid
  lastModifiedBy          String?   @db.Uuid
  modificationHistory     Json?
  isArchived              Boolean   @default(false)
  isCancelled             Boolean   @default(false)
  cancellationReason      String?   @db.Text
  cancelledAt             DateTime?
  paymentReminderSent     Boolean   @default(false)
  reminderSentAt          DateTime?
  dueReminderSent         Boolean   @default(false)
  overdueReminderSent     Boolean   @default(false)
  tags                    Json?
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  // Add opposite relation here for Appointment
  appointments            Appointment[]

  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  hospital                Hospital? @relation(fields: [hospitalId], references: [hospitalId], onDelete: SetNull)
  payment                 Payment?  @relation(fields: [paymentId], references: [id], onDelete: SetNull)

  @@index([bookingId])
  @@index([userId])
  @@index([status])
  @@index([invoiceDate])
  @@map("invoices")
}

model LabReport {
  reportId                String    @id @default(uuid()) @db.Uuid
  patientId               String    @db.Uuid
  labTestId               String?   @db.Uuid
  laboratoryId            String?   @db.Uuid
  doctorId                String?   @db.Uuid
  bookingId               String?   @db.Uuid
  reportNumber            String    @unique @db.VarChar(100)
  testName                String    @db.VarChar(255)
  testType                String?   @db.VarChar(100)
  testDate                DateTime  @db.Date
  reportDate              DateTime? @db.Date
  results                 Json?
  normalRange             Json?
  interpretation          String?   @db.Text
  fileUrl                 String?   @db.VarChar(500)
  fileName                String?   @db.VarChar(255)
  status                  String    @default("pending") @db.VarChar(50)
  priority                String    @default("routine") @db.VarChar(50)
  notes                   String?   @db.Text
  isAbnormal              Boolean   @default(false)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  labTest                 LabTest?  @relation(fields: [labTestId], references: [testId], onDelete: SetNull)
  laboratory              Laboratory? @relation(fields: [laboratoryId], references: [laboratoryId], onDelete: SetNull)
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  
  @@index([patientId])
  @@index([labTestId])
  @@index([laboratoryId])
  @@index([reportNumber])
  @@index([status])
  @@index([testDate])
  @@map("lab_reports")
}

model LabTest {
  testId                  String    @id @default(uuid()) @db.Uuid
  laboratoryId            String    @db.Uuid
  appointmentId           String?   @db.Uuid
  userId                  String?   @db.Uuid
  name                    String    @db.VarChar(150)
  code                    String?   @db.VarChar(50)
  type                    String?   @db.VarChar(100)
  category                String?   @db.VarChar(100)
  description             String?   @db.Text
  preparationRequired     Boolean   @default(false)
  preparationInstructions String?   @db.Text
  fastingRequired         Boolean   @default(false)
  fastingHours            Int?
  sampleQualityCheck      Boolean   @default(true)
  expectedTurnaroundDays  Int?
  expectedTurnaroundHours Int?
  priorityTurnaroundDays  Int?
  referenceRange          Json?
  referenceRangeUnit      String?   @db.VarChar(50)
  genderSpecific          Boolean   @default(false)
  ageSpecific             Boolean   @default(false)
  status                  String    @default("ordered") @db.VarChar(50)
  statusHistory           Json?
  result                  String?   @db.Text
  resultValue             Decimal?  @db.Decimal(12, 4)
  resultUnit              String?   @db.VarChar(50)
  resultInterpretation    String?   @db.VarChar(50)
  resultAbnormality       String?   @db.Text
  reportFile              String?   @db.VarChar(500)
  reportGeneratedAt       DateTime?
  reportVerifiedBy        String?   @db.Uuid
  reportVerifiedAt        DateTime?
  reportComments          String?   @db.Text
  internalNotes           String?   @db.Text
  tags                    Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  laboratory              Laboratory @relation(fields: [laboratoryId], references: [laboratoryId], onDelete: Cascade)
  appointment             Appointment? @relation(fields: [appointmentId], references: [appointmentId], onDelete: SetNull)
  labReports              LabReport[]
  
  @@index([laboratoryId])
  @@index([appointmentId])
  @@index([userId])
  @@index([status])
  @@map("lab_tests")
}

model Laboratory {
  laboratoryId            String    @id @default(uuid()) @db.Uuid
  hospitalId              String    @db.Uuid
  name                    String    @db.VarChar(150)
  code                    String?   @unique @db.VarChar(50)
  type                    String?   @db.VarChar(100)
  description             String?   @db.Text
  accreditations          Json?
  certifications          Json?
  phone                   String?   @db.VarChar(20)
  email                   String?   @db.VarChar(255)
  address                 String?   @db.Text
  city                    String?   @db.VarChar(100)
  state                   String?   @db.VarChar(100)
  postalCode              String?   @db.VarChar(20)
  workingHours            Json?
  is24x7                  Boolean   @default(false)
  testCapacity            Int?
  equipment               Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  hospital                Hospital  @relation(fields: [hospitalId], references: [hospitalId], onDelete: Cascade)
  labTests                LabTest[]
  labReports              LabReport[]
  dnaKits                 DNAKit[]
  
  @@index([hospitalId])
  @@map("laboratories")
}

model Media {
  mediaId                 String    @id @default(uuid()) @db.Uuid
  filename                String    @db.VarChar(255)
  originalFilename        String?   @db.VarChar(255)
  fileSize                Int
  mimeType                String    @db.VarChar(100)
  fileExtension           String?   @db.VarChar(10)
  url                     String    @db.VarChar(500)
  storagePath             String?   @db.VarChar(500)
  storageProvider         String    @default("s3") @db.VarChar(50)
  storageKey              String?   @db.VarChar(500)
  type                    String    @db.VarChar(50)
  category                String?   @db.VarChar(100)
  width                   Int?
  height                  Int?
  aspectRatio             String?   @db.VarChar(20)
  thumbnailUrl            String?   @db.VarChar(500)
  optimizedUrl            String?   @db.VarChar(500)
  duration                Int?
  videoCodec              String?   @db.VarChar(50)
  audioCodec              String?   @db.VarChar(50)
  uploadedBy              String?   @db.Uuid
  entityType              String?   @db.VarChar(50)
  entityId                String?   @db.Uuid
  title                   String?   @db.VarChar(255)
  description             String?   @db.Text
  altText                 String?   @db.VarChar(255)
  caption                 String?   @db.Text
  metadata                Json?
  exif                    Json?
  tags                    Json?
  isPublic                Boolean   @default(false)
  isPrimary               Boolean   @default(false)
  displayOrder            Int       @default(0)
  isActive                Boolean   @default(true)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@index([entityType, entityId])
  @@index([category])
  @@index([uploadedBy])
  @@map("media")
}

model MedicalDocument {
  documentId              String    @id @default(uuid()) @db.Uuid
  patientId               String    @db.Uuid
  uploadedBy              String?   @db.Uuid
  bookingId               String?   @db.Uuid
  appointmentId           String?   @db.Uuid
  documentType            String    @db.VarChar(100)
  documentCategory        String?   @db.VarChar(100)
  documentName            String    @db.VarChar(255)
  documentNumber          String?   @db.VarChar(100)
  description             String?   @db.Text
  fileName                String    @db.VarChar(255)
  fileUrl                 String    @db.VarChar(500)
  fileSize                BigInt
  fileType                String    @db.VarChar(100)
  mimeType                String?   @db.VarChar(100)
  storageProvider         String?   @default("imagekit") @db.VarChar(50)
  storageKey              String?   @db.VarChar(500)
  thumbnailUrl            String?   @db.VarChar(500)
  issueDate               DateTime? @db.Date
  expiryDate              DateTime? @db.Date
  issuedBy                String?   @db.VarChar(255)
  issuingAuthority        String?   @db.VarChar(255)
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  verifiedBy              String?   @db.Uuid
  verificationNotes       String?   @db.Text
  status                  String    @default("active") @db.VarChar(50)
  isConfidential          Boolean   @default(true)
  accessLevel             String    @default("private") @db.VarChar(50)
  sharedWith              Json?
  tags                    Json?
  notes                   String?   @db.Text
  metadata                Json?
  version                 Int       @default(1)
  previousVersionId       String?   @db.Uuid
  isLatestVersion         Boolean   @default(true)
  downloadCount           Int       @default(0)
  lastDownloadedAt        DateTime?
  uploadedAt              DateTime  @default(now())
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  
  @@index([patientId])
  @@index([bookingId])
  @@index([documentType])
  @@index([status])
  @@index([isVerified])
  @@map("medical_documents")
}

model MedicalRecord {
  recordId                String    @id @default(uuid()) @db.Uuid
  patientId               String    @db.Uuid
  doctorId                String?   @db.Uuid
  appointmentId           String?   @db.Uuid
  bookingId               String?   @db.Uuid
  recordType              String    @db.VarChar(100)
  recordDate              DateTime  @db.Date
  title                   String    @db.VarChar(255)
  description             String?   @db.Text
  chiefComplaint          String?   @db.Text
  presentIllness          String?   @db.Text
  medicalHistory          String?   @db.Text
  familyHistory           String?   @db.Text
  socialHistory           String?   @db.Text
  allergies               Json?
  currentMedications      Json?
  vitalSigns              Json?
  physicalExamination     String?   @db.Text
  diagnosis               String?   @db.Text
  treatmentPlan           String?   @db.Text
  prescriptions           Json?
  labTests                Json?
  imaging                 Json?
  procedures              Json?
  followUpInstructions    String?   @db.Text
  doctorNotes             String?   @db.Text
  clinicalNotes           String?   @db.Text
  isConfidential          Boolean   @default(true)
  accessLevel             String    @default("private") @db.VarChar(50)
  sharedWith              Json?
  attachments             Json?
  status                  String    @default("active") @db.VarChar(50)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  
  @@index([patientId])
  @@index([doctorId])
  @@index([appointmentId])
  @@index([bookingId])
  @@index([recordDate])
  @@map("medical_records")
}

model MedicalReview {
  reviewId                String    @id @default(uuid()) @db.Uuid
  patientId               String    @db.Uuid
  doctorId                String?   @db.Uuid
  appointmentId           String?   @db.Uuid
  bookingId               String?   @db.Uuid
  hospitalId              String?   @db.Uuid
  treatmentId             String?   @db.Uuid
  reviewType              String    @db.VarChar(50)
  rating                  Int
  title                   String?   @db.VarChar(255)
  review                  String?   @db.Text
  pros                    String?   @db.Text
  cons                    String?   @db.Text
  medicalOutcome          String?   @db.Text
  treatmentEffectiveness  Int?
  hospitalCleanliness     Int?
  staffBehavior           Int?
  facilityQuality         Int?
  valueForMoney           Int?
  waitTime                Int?
  wouldRecommend          Boolean?
  verificationStatus      String    @default("pending") @db.VarChar(50)
  verifiedAt              DateTime?
  verifiedBy              String?   @db.Uuid
  isPublished             Boolean   @default(false)
  publishedAt             DateTime?
  helpfulCount            Int       @default(0)
  reportedCount           Int       @default(0)
  moderationNotes         String?   @db.Text
  images                  Json?
  videos                  Json?
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@index([patientId])
  @@index([doctorId])
  @@index([hospitalId])
  @@index([rating])
  @@index([verificationStatus])
  @@map("medical_reviews")
}

model Notification {
  notificationId          String    @id @default(uuid()) @db.Uuid
  userId                  String    @db.Uuid
  type                    String    @db.VarChar(100)
  category                String?   @db.VarChar(100)
  title                   String    @db.VarChar(255)
  message                 String    @db.Text
  data                    Json?
  entityType              String?   @db.VarChar(50)
  entityId                String?   @db.Uuid
  actionUrl               String?   @db.VarChar(500)
  actionType              String?   @db.VarChar(50)
  actionLabel             String?   @db.VarChar(100)
  priority                String    @default("normal") @db.VarChar(20)
  channel                 String    @default("in-app") @db.VarChar(50)
  isRead                  Boolean   @default(false)
  readAt                  DateTime?
  isArchived              Boolean   @default(false)
  archivedAt              DateTime?
  sentViaEmail            Boolean   @default(false)
  sentViaSMS              Boolean   @default(false)
  sentViaPush             Boolean   @default(false)
  metadata                Json?
  expiresAt               DateTime?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  
  @@index([userId])
  @@index([isRead])
  @@index([type])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationPreference {
  preferenceId            String    @id @default(uuid()) @db.Uuid
  userId                  String    @db.Uuid
  channel                 String    @db.VarChar(50)
  category                String    @db.VarChar(100)
  isEnabled               Boolean   @default(true)
  frequency               String?   @default("realtime") @db.VarChar(50)
  schedule                Json?
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@unique([userId, channel, category])
  @@index([userId])
  @@map("notification_preferences")
}

model Package {
  packageId               String    @id @default(uuid()) @db.Uuid
  treatmentId             String    @db.Uuid
  hospitalId              String    @db.Uuid
  countryId               String?   @db.Uuid
  cityId                  String?   @db.Uuid
  packageName             String    @db.VarChar(255)
  packageCode             String?   @unique @db.VarChar(50)
  description             String?   @db.Text
  shortDescription        String?   @db.VarChar(500)
  duration                Int?
  durationUnit            String?   @default("days") @db.VarChar(20)
  basePrice               Decimal   @db.Decimal(12, 2)
  discountedPrice         Decimal?  @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  inclusions              Json?
  exclusions              Json?
  procedures              Json?
  accommodation           Json?
  meals                   Json?
  transportation          Json?
  visaAssistance          Boolean   @default(false)
  airportPickup           Boolean   @default(false)
  followUpCare            Boolean   @default(false)
  interpreterService      Boolean   @default(false)
  status                  String    @default("active") @db.VarChar(50)
  isPopular               Boolean   @default(false)
  isFeatured              Boolean   @default(false)
  displayOrder            Int       @default(0)
  images                  Json?
  bookingsCount           Int       @default(0)
  rating                  Decimal?  @db.Decimal(3, 2)
  reviewsCount            Int       @default(0)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  treatment               Treatment @relation(fields: [treatmentId], references: [treatmentId], onDelete: Cascade)
  hospital                Hospital  @relation(fields: [hospitalId], references: [hospitalId], onDelete: Cascade)
  country                 Country?  @relation(fields: [countryId], references: [countryId], onDelete: SetNull)
  city                    City?     @relation(fields: [cityId], references: [cityId], onDelete: SetNull)
  bookings                Booking[]
  
  @@index([treatmentId])
  @@index([hospitalId])
  @@index([status])
  @@index([isPopular])
  @@map("packages")
}

// Password Reset Model - Password reset tokens and requests
// NO optional chaining - Production Ready
model PasswordReset {
  // ========== PRIMARY KEY ==========
  resetId                 String    @id @default(uuid()) @db.Uuid
  
  // ========== FOREIGN KEYS ==========
  userId                  String    @db.Uuid
  
  // ========== TOKEN DETAILS ==========
  token                   String    @unique @db.VarChar(500)
  tokenHash               String?   @db.VarChar(500)    // Hashed version for extra security
  expiresAt               DateTime
  
  // ========== REQUEST DETAILS ==========
  email                   String    @db.VarChar(255)
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  requestMethod           String    @default("email") @db.VarChar(20)  // email, sms, app
  
  // ========== STATUS ==========
  status                  String    @default("pending") @db.VarChar(50)  // pending, used, expired, cancelled
  usedAt                  DateTime?
  
  // ========== TIMESTAMPS ==========
  createdAt               DateTime  @default(now())
  
  // ========== RELATIONSHIPS ==========
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  
  // ========== INDEXES ==========
  @@index([userId])
  @@index([token])
  @@index([status])
  @@index([expiresAt])
  
  // ========== TABLE MAPPING ==========
  @@map("password_resets")
}

model Patient {
  patientId               String    @id @default(uuid()) @db.Uuid
  userId                  String    @unique @db.Uuid
  bloodType               String?   @db.VarChar(20)
  height                  Decimal?  @db.Decimal(5, 2)
  weight                  Decimal?  @db.Decimal(5, 2)
  bmi                     Decimal?  @db.Decimal(5, 2)
  allergies               Json?
  chronicConditions       Json?
  familyMedicalHistory    Json?
  surgicalHistory         Json?
  currentMedications      Json?
  pastMedications         Json?
  smoker                  Boolean?
  alcoholUser             Boolean?
  exerciseFrequency       String?   @db.VarChar(50)
  preferredLanguage       String    @default("en") @db.VarChar(10)
  preferredGenderOfDoctor String    @default("nopreference") @db.VarChar(20)
  hasInsurance            Boolean   @default(false)
  emergencyContactName    String?   @db.VarChar(255)
  emergencyContactPhone   String?   @db.VarChar(20)
  emergencyContactRelation String?  @db.VarChar(50)
  totalConsultations      Int       @default(0)
  totalTreatments         Int       @default(0)
  totalHospitals          Int       @default(0)
  isActive                Boolean   @default(true)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  familyMemberProfile     FamilyMember?
  user                    User                      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  bookings                Booking[]
  medicalDocuments        MedicalDocument[]
  medicalRecords          MedicalRecord[]
  prescriptions           Prescription[]
  labReports              LabReport[]
  immunizations           Immunization[]
  vitalSigns              VitalSign[]
  comorbidConditions      ComorbidCondition[]
  patientTreatmentPlans   PatientTreatmentPlan[]
  consultations           Consultation[]
  dnaKits                 DNAKit[]
  insuranceDocuments      InsuranceDocument[]
  
  @@index([userId])
  @@index([isActive])
  @@map("patients")
}

model PatientDocument {
  documentId              String    @id @default(uuid()) @db.Uuid
  patientId               String    @db.Uuid
  uploadedBy              String?   @db.Uuid
  documentType            String    @db.VarChar(100)
  documentCategory        String?   @db.VarChar(100)
  documentName            String    @db.VarChar(255)
  fileName                String    @db.VarChar(255)
  fileUrl                 String    @db.VarChar(500)
  fileSize                BigInt
  fileType                String    @db.VarChar(100)
  mimeType                String?   @db.VarChar(100)
  storageProvider         String?   @default("imagekit") @db.VarChar(50)
  storageKey              String?   @db.VarChar(500)
  thumbnailUrl            String?   @db.VarChar(500)
  issueDate               DateTime? @db.Date
  expiryDate              DateTime? @db.Date
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  verifiedBy              String?   @db.Uuid
  status                  String    @default("active") @db.VarChar(50)
  isConfidential          Boolean   @default(true)
  accessLevel             String    @default("private") @db.VarChar(50)
  tags                    Json?
  notes                   String?   @db.Text
  metadata                Json?
  version                 Int       @default(1)
  isLatestVersion         Boolean   @default(true)
  downloadCount           Int       @default(0)
  lastDownloadedAt        DateTime?
  uploadedAt              DateTime  @default(now())
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@index([patientId])
  @@index([documentType])
  @@index([status])
  @@map("patient_documents")
}

// Patient Treatment Plan Model - Treatment plans for patients
// NO optional chaining - Production Ready
model PatientTreatmentPlan {
  // ========== PRIMARY KEY ==========
  planId                  String    @id @default(uuid()) @db.Uuid
  
  // ========== FOREIGN KEYS ==========
  patientId               String    @db.Uuid
  doctorId                String?   @db.Uuid
  treatmentId             String?   @db.Uuid
  bookingId               String?   @db.Uuid
  
  // ========== PLAN DETAILS ==========
  planName                String    @db.VarChar(255)
  description             String?   @db.Text
  
  // ========== PLAN COMPONENTS ==========
  goals                   Json?     // Array of treatment goals
  procedures              Json?     // Array of procedures in plan
  medications             Json?     // Medication schedule
  lifestyle               Json?     // Lifestyle recommendations
  diet                    Json?     // Dietary guidelines
  exercise                Json?     // Exercise regimen
  followUps               Json?     // Follow-up appointments schedule
  
  // ========== TIMELINE ==========
  startDate               DateTime  @db.Date
  endDate                 DateTime? @db.Date
  duration                Int?      // Duration in days
  
  // ========== STATUS & PROGRESS ==========
  status                  String    @default("active") @db.VarChar(50)  // active, completed, cancelled
  progress                Decimal?  @db.Decimal(5, 2)  // Progress percentage 0-100
  
  // ========== ADDITIONAL INFO ==========
  notes                   String?   @db.Text
  
  // ========== TIMESTAMPS ==========
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // ========== RELATIONSHIPS ==========
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  treatment               Treatment? @relation(fields: [treatmentId], references: [treatmentId], onDelete: SetNull)
  
  // ========== INDEXES ==========
  @@index([patientId])
  @@index([doctorId])
  @@index([status])
  
  // ========== TABLE MAPPING ==========
  @@map("patient_treatment_plans")
}

// Payment Model - Payment transactions for bookings
// NO optional chaining - Production Ready
model Payment {
  // ========== PRIMARY KEY ==========
  id                      Int       @id @default(autoincrement())
  
  // ========== FOREIGN KEYS ==========
  bookingId               String    @db.Uuid
  patientId               String    @db.Uuid
  
  // ========== PAYMENT DETAILS ==========
  amount                  Decimal   @db.Decimal(12, 2)
  currency                String    @default("INR") @db.VarChar(3)
  gateway                 String    @db.VarChar(50)     // razorpay, stripe, paypal
  transactionId           String    @unique @db.VarChar(255)
  
  // ========== STATUS ==========
  paymentStatus           String    @default("pending") @db.VarChar(50)  // pending, completed, failed, refunded
  paymentMethod           String?   @db.VarChar(50)     // card, upi, netbanking, wallet
  
  // ========== PAYMENT DATA ==========
  paymentDetails          Json?     // Gateway response, card details (masked), etc
  receiptUrl              String?   @db.VarChar(500)
  errorMessage            String?   @db.Text
  
  // ========== TIMESTAMPS ==========
  completedAt             DateTime?
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")
  
  // ========== RELATIONSHIPS ==========
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  user                    User      @relation(fields: [patientId], references: [userId], onDelete: Cascade)
  invoices                Invoice[]
  accommodations          Accommodation[]
  appointments            Appointment[]
  
  // ========== INDEXES ==========
  @@index([bookingId])
  @@index([patientId])
  @@index([paymentStatus])
  
  // ========== TABLE MAPPING ==========
  @@map("payments")
}

model Prescription {
  prescriptionId          String    @id @default(uuid()) @db.Uuid
  appointmentId           String?   @db.Uuid @unique  // Unique for one-to-one relation
  userId                  String    @db.Uuid
  patientId               String    @db.Uuid
  doctorId                String?   @db.Uuid
  hospitalId              String?   @db.Uuid
  prescriptionNumber      String    @unique @db.VarChar(100)
  type                    String    @default("medication") @db.VarChar(50)
  status                  String    @default("draft") @db.VarChar(50)
  medications             Json
  dosageInstructions      String?   @db.Text
  frequency               String?   @db.VarChar(50)
  duration                Int?
  durationUnit            String    @default("days") @db.VarChar(20)
  refillsAllowed          Int       @default(0)
  refillsUsed             Int       @default(0)
  validFrom               DateTime  @db.Date
  validUntil              DateTime? @db.Date
  notes                   String?   @db.Text
  isActive                Boolean   @default(true)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // Relations (only define fields, references, onDelete on one side)
  appointment             Appointment?  // relation without fields, references here
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  doctor                  Doctor?   @relation(fields: [doctorId], references: [doctorId], onDelete: SetNull)
  
  @@index([appointmentId])
  @@index([userId])
  @@index([patientId])
  @@index([doctorId])
  @@index([prescriptionNumber])
  @@index([status])
  @@map("prescriptions")
}

model PrivacyPolicy {
  policyId                String    @id @default(uuid()) @db.Uuid
  version                 String    @db.VarChar(50)
  title                   String    @db.VarChar(255)
  content                 String    @db.Text
  effectiveDate           DateTime  @db.Date
  expiryDate              DateTime? @db.Date
  isActive                Boolean   @default(false)
  isCurrent               Boolean   @default(false)
  language                String    @default("en") @db.VarChar(10)
  publishedAt             DateTime?
  publishedBy             String?   @db.Uuid
  approvedBy              String?   @db.Uuid
  approvedAt              DateTime?
  summary                 String?   @db.Text
  changes                 String?   @db.Text
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@unique([version, language])
  @@index([isActive])
  @@index([isCurrent])
  @@index([effectiveDate])
  @@map("privacy_policies")
}


model Profile {
  profileId               String    @id @default(uuid()) @db.Uuid
  userId                  String    @unique @db.Uuid
  bio                     String?   @db.Text
  headline                String?   @db.VarChar(255)
  website                 String?   @db.VarChar(500)
  socialLinks             Json?
  languages               Json?
  timezone                String?   @db.VarChar(100)
  nationality             String?   @db.VarChar(100)
  passportNumber          String?   @db.VarChar(100)
  passportExpiry          DateTime? @db.Date
  emergencyContact        Json?
  medicalHistory          Json?
  allergies               Json?
  currentMedications      Json?
  bloodType               String?   @db.VarChar(10)
  insuranceInfo           Json?
  preferences             Json?
  privacy                 Json?
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@index([userId])
  @@map("profiles")
}

model Rating {
  ratingId                String    @id @default(uuid()) @db.Uuid
  userId                  String    @db.Uuid
  entityType              String    @db.VarChar(50)
  entityId                String    @db.Uuid
  rating                  Decimal   @db.Decimal(3, 2)
  maxRating               Decimal   @default(5.00) @db.Decimal(3, 2)
  ratingDimensions        Json?
  comment                 String?   @db.Text
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@unique([userId, entityType, entityId])
  @@index([userId])
  @@index([entityType, entityId])
  @@index([rating])
  @@map("ratings")
}

model RefreshToken {
  tokenId                 String    @id @default(uuid()) @db.Uuid
  userId                  String    @db.Uuid
  token                   String    @unique @db.VarChar(500)
  deviceId                String?   @db.Uuid
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  expiresAt               DateTime
  isRevoked               Boolean   @default(false)
  revokedAt               DateTime?
  revokedBy               String?   @db.Uuid
  revokedReason           String?   @db.VarChar(255)
  replacedBy              String?   @db.Uuid
  createdAt               DateTime  @default(now())
  
  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("refresh_tokens")
}

model Refund {
  refundId                String    @id @default(uuid()) @db.Uuid
  bookingId               String    @db.Uuid
  userId                  String    @db.Uuid
  paymentId               String?   @db.Uuid
  amount                  Decimal   @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  reason                  String    @db.Text
  status                  String    @default("pending") @db.VarChar(50)
  refundMethod            String?   @db.VarChar(50)
  gatewayRefundId         String?   @db.VarChar(255)
  processedBy             String?   @db.Uuid
  processedAt             DateTime?
  notes                   String?   @db.Text
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  
  @@index([bookingId])
  @@index([userId])
  @@index([status])
  @@map("refunds")
}

model Review {
  reviewId                String    @id @default(uuid()) @db.Uuid
  userId                  String    @db.Uuid
  entityType              String    @db.VarChar(50)
  entityId                String    @db.Uuid
  rating                  Int
  title                   String?   @db.VarChar(255)
  comment                 String?   @db.Text
  pros                    String?   @db.Text
  cons                    String?   @db.Text
  isVerified              Boolean   @default(false)
  verifiedAt              DateTime?
  isAnonymous             Boolean   @default(false)
  helpfulCount            Int       @default(0)
  unhelpfulCount          Int       @default(0)
  status                  String    @default("pending") @db.VarChar(50)
  moderatedBy             String?   @db.Uuid
  moderatedAt             DateTime?
  moderationNotes         String?   @db.Text
  isPublished             Boolean   @default(false)
  publishedAt             DateTime?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  user                    User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  
  @@index([userId])
  @@index([entityType, entityId])
  @@index([rating])
  @@index([status])
  @@map("reviews")
}

model SMSLog {
  smsId                   String    @id @default(uuid()) @db.Uuid
  userId                  String?   @db.Uuid
  recipient               String    @db.VarChar(20)
  countryCode             String?   @db.VarChar(10)
  message                 String    @db.Text
  smsType                 String    @db.VarChar(50)
  provider                String?   @db.VarChar(50)
  providerId              String?   @db.VarChar(255)
  status                  String    @default("pending") @db.VarChar(50)
  sentAt                  DateTime?
  deliveredAt             DateTime?
  failedAt                DateTime?
  errorMessage            String?   @db.Text
  cost                    Decimal?  @db.Decimal(10, 4)
  currency                String?   @default("USD") @db.VarChar(3)
  metadata                Json?
  createdAt               DateTime  @default(now())
  
  @@index([userId])
  @@index([recipient])
  @@index([status])
  @@index([sentAt])
  @@map("sms_logs")
}

model Session {
  sessionId              String    @id @default(uuid()) @db.Uuid
  userId                 String    @db.Uuid
  token                  String    @unique @db.VarChar(500)
  refreshToken           String?   @unique @db.VarChar(500)
  ipAddress              String?   @db.VarChar(45)
  userAgent              String?   @db.Text
  deviceId               String?   @db.Uuid
  deviceName             String?   @db.VarChar(255)
  deviceType             String?   @db.VarChar(50)
  browser                String?   @db.VarChar(100)
  os                     String?   @db.VarChar(100)
  location               String?   @db.VarChar(255)
  isActive               Boolean   @default(true)
  expiresAt              DateTime
  lastActivityAt         DateTime  @default(now())
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  user                   User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  device                 Device?   @relation(fields: [deviceId], references: [deviceId], onDelete: SetNull)
  
  @@index([userId])
  @@index([deviceId])
  @@index([token])
  @@index([isActive])
  @@index([expiresAt])
  @@map("sessions")
}

model Settings {
  settingId              String    @id @default(uuid()) @db.Uuid
  userId                 String?   @db.Uuid
  category               String    @db.VarChar(100)
  key                    String    @db.VarChar(255)
  value                  String?   @db.Text
  valueType              String    @default("string") @db.VarChar(50)
  isPublic               Boolean   @default(false)
  isEditable             Boolean   @default(true)
  description            String?   @db.Text
  metadata               Json?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  @@unique([userId, category, key])
  @@index([userId])
  @@index([category])
  @@index([key])
  @@map("settings")
}

model Specialization {
  specializationId       String    @id @default(uuid()) @db.Uuid
  name                   String    @unique @db.VarChar(255)
  code                   String?   @unique @db.VarChar(50)
  description            String?   @db.Text
  category               String?   @db.VarChar(100)
  parentId               String?   @db.Uuid
  isActive               Boolean   @default(true)
  displayOrder           Int       @default(0)
  icon                   String?   @db.VarChar(255)
  imageUrl               String?   @db.VarChar(500)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  doctors                Doctor[]
  
  @@index([parentId])
  @@index([isActive])
  @@map("specializations")
}

model State {
  stateId                 String    @id @default(uuid()) @db.Uuid
  countryId               String    @db.Uuid
  name                    String    @db.VarChar(255)
  code                    String?   @db.VarChar(10)
  latitude                Decimal?  @db.Decimal(10, 8)
  longitude               Decimal?  @db.Decimal(11, 8)
  isActive                Boolean   @default(true)
  displayOrder            Int       @default(0)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  country                 Country   @relation(fields: [countryId], references: [countryId], onDelete: Cascade)
  cities                  City[]
  
  @@unique([countryId, name])
  @@index([countryId])
  @@index([isActive])
  @@map("states")
}

model Subscription {
  subscriptionId          String    @id @default(uuid()) @db.Uuid
  userId                  String    @db.Uuid
  planId                  String    @db.Uuid
  status                  String    @default("active") @db.VarChar(50)
  startDate               DateTime  @db.Date
  endDate                 DateTime? @db.Date
  currentPeriodStart      DateTime  @db.Date
  currentPeriodEnd        DateTime  @db.Date
  trialStart              DateTime? @db.Date
  trialEnd                DateTime? @db.Date
  cancelledAt             DateTime?
  cancellationReason      String?   @db.Text
  pausedAt                DateTime?
  resumedAt               DateTime?
  billingCycle            String    @default("monthly") @db.VarChar(50)
  amount                  Decimal   @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  paymentMethod           String?   @db.VarChar(50)
  autoRenew               Boolean   @default(true)
  renewalCount            Int       @default(0)
  lastRenewedAt           DateTime?
  nextBillingDate         DateTime?
  gracePeriodEndsAt       DateTime?
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  plan                    SubscriptionPlan @relation(fields: [planId], references: [planId], onDelete: Restrict)
  
  @@index([userId])
  @@index([planId])
  @@index([status])
  @@index([nextBillingDate])
  @@map("subscriptions")
}

model SubscriptionPlan {
  planId                  String    @id @default(uuid()) @db.Uuid
  name                    String    @db.VarChar(255)
  code                    String    @unique @db.VarChar(50)
  description             String?   @db.Text
  shortDescription        String?   @db.VarChar(500)
  type                    String    @db.VarChar(50)
  billingCycle            String    @db.VarChar(50)
  price                   Decimal   @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  trialPeriodDays         Int?
  features                Json
  limitations             Json?
  maxUsers                Int?
  maxBookings             Int?
  prioritySupport         Boolean   @default(false)
  telemedicineAccess      Boolean   @default(false)
  familyMembersAllowed    Int?
  discountPercentage      Decimal?  @db.Decimal(5, 2)
  isActive                Boolean   @default(true)
  isFeatured              Boolean   @default(false)
  isPopular               Boolean   @default(false)
  displayOrder            Int       @default(0)
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  subscriptions           Subscription[]
  
  @@index([code])
  @@index([isActive])
  @@map("subscription_plans")
}

model SupportTicket {
  ticketId               String    @id @default(uuid()) @db.Uuid
  userId                 String    @db.Uuid
  ticketNumber           String    @unique @db.VarChar(50)
  subject                String    @db.VarChar(255)
  description            String    @db.Text
  category               String    @db.VarChar(100)
  priority               String    @default("medium") @db.VarChar(20)
  status                 String    @default("open") @db.VarChar(50)
  assignedTo             String?   @db.Uuid
  relatedEntityType      String?   @db.VarChar(50)
  relatedEntityId        String?   @db.Uuid
  resolution             String?   @db.Text
  resolvedAt             DateTime?
  closedAt               DateTime?
  tags                   Json?
  attachments            Json?
  metadata               Json?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  user                   User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  
  @@index([userId])
  @@index([ticketNumber])
  @@index([status])
  @@index([category])
  @@index([priority])
  @@map("support_tickets")
}

model TermsConditions {
  termsId                 String    @id @default(uuid()) @db.Uuid
  version                 String    @db.VarChar(50)
  title                   String    @db.VarChar(255)
  content                 String    @db.Text
  effectiveDate           DateTime  @db.Date
  expiryDate              DateTime? @db.Date
  isActive                Boolean   @default(false)
  isCurrent               Boolean   @default(false)
  language                String    @default("en") @db.VarChar(10)
  publishedAt             DateTime?
  publishedBy             String?   @db.Uuid
  approvedBy              String?   @db.Uuid
  approvedAt              DateTime?
  summary                 String?   @db.Text
  changes                 String?   @db.Text
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@unique([version, language])
  @@index([isActive])
  @@index([isCurrent])
  @@index([effectiveDate])
  @@map("terms_conditions")
}

model Train {
  trainId                 String    @id @default(uuid()) @db.Uuid
  bookingId               String    @db.Uuid
  userId                  String    @db.Uuid
  trainNumber             String?   @db.VarChar(50)
  trainName               String?   @db.VarChar(255)
  departureStation        String    @db.VarChar(255)
  departureStationCode    String?   @db.VarChar(10)
  arrivalStation          String    @db.VarChar(255)
  arrivalStationCode      String?   @db.VarChar(10)
  departureDate           DateTime  @db.Date
  departureTime           String?   @db.VarChar(20)
  arrivalDate             DateTime? @db.Date
  arrivalTime             String?   @db.VarChar(20)
  duration                Int?
  class                   String?   @db.VarChar(50)
  coach                   String?   @db.VarChar(20)
  seatNumber              String?   @db.VarChar(20)
  berth                   String?   @db.VarChar(20)
  pnr                     String?   @db.VarChar(50)
  bookingReference        String?   @db.VarChar(100)
  price                   Decimal?  @db.Decimal(12, 2)
  currency                String    @default("INR") @db.VarChar(3)
  status                  String    @default("pending") @db.VarChar(50)
  ticketUrl               String?   @db.VarChar(500)
  eTicketNumber           String?   @db.VarChar(100)
  passengerName           String?   @db.VarChar(255)
  passengerAge            Int?
  passengerGender         String?   @db.VarChar(10)
  foodPreference          String?   @db.VarChar(50)
  cancelledAt             DateTime?
  cancellationReason      String?   @db.Text
  refundAmount            Decimal?  @db.Decimal(12, 2)
  notes                   String?   @db.Text
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  
  @@index([bookingId])
  @@index([userId])
  @@index([status])
  @@index([departureDate])
  @@map("trains")
}

model Transaction {
  transactionId          String    @id @default(uuid()) @db.Uuid
  userId                 String    @db.Uuid
  bookingId              String?   @db.Uuid
  paymentId              String?   @db.Uuid
  type                   String    @db.VarChar(50)
  amount                 Decimal   @db.Decimal(12, 2)
  currency               String    @default("USD") @db.VarChar(3)
  status                 String    @default("pending") @db.VarChar(50)
  gateway                String?   @db.VarChar(50)
  gatewayTransactionId   String?   @db.VarChar(255)
  paymentMethod          String?   @db.VarChar(50)
  description            String?   @db.Text
  metadata               Json?
  failureReason          String?   @db.Text
  processedAt            DateTime?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  user                   User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  
  @@index([userId])
  @@index([bookingId])
  @@index([paymentId])
  @@index([status])
  @@index([type])
  @@map("transactions")
}

model Translation {
  translationId           String    @id @default(uuid()) @db.Uuid
  key                     String    @db.VarChar(255)
  language                String    @db.VarChar(10)
  value                   String    @db.Text
  context                 String?   @db.VarChar(100)
  category                String?   @db.VarChar(100)
  isActive                Boolean   @default(true)
  isAutoTranslated        Boolean   @default(false)
  translatedBy            String?   @db.Uuid
  verifiedBy              String?   @db.Uuid
  verifiedAt              DateTime?
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@unique([key, language])
  @@index([key])
  @@index([language])
  @@index([category])
  @@map("translations")
}

model TravelArrangement {
  arrangementId           String    @id @default(uuid()) @db.Uuid
  bookingId               String    @db.Uuid
  userId                  String    @db.Uuid
  arrangementType         String    @db.VarChar(50)
  provider                String?   @db.VarChar(255)
  bookingReference        String?   @db.VarChar(100)
  details                 Json
  origin                  String?   @db.VarChar(255)
  destination             String?   @db.VarChar(255)
  departureDate           DateTime? @db.Date
  departureTime           String?   @db.VarChar(20)
  arrivalDate             DateTime? @db.Date
  arrivalTime             String?   @db.VarChar(20)
  pickupLocation          String?   @db.VarChar(500)
  dropoffLocation         String?   @db.VarChar(500)
  pickupTime              String?   @db.VarChar(20)
  vehicleType             String?   @db.VarChar(100)
  driverName              String?   @db.VarChar(255)
  driverPhone             String?   @db.VarChar(20)
  price                   Decimal?  @db.Decimal(12, 2)
  currency                String    @default("USD") @db.VarChar(3)
  status                  String    @default("pending") @db.VarChar(50)
  confirmedAt             DateTime?
  completedAt             DateTime?
  cancelledAt             DateTime?
  cancellationReason      String?   @db.Text
  notes                   String?   @db.Text
  specialRequests         String?   @db.Text
  metadata                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  
  @@index([bookingId])
  @@index([userId])
  @@index([arrangementType])
  @@index([status])
  @@map("travel_arrangements")
}

model Treatment {
  treatmentId            String    @id @default(uuid()) @db.Uuid
  categoryId             String?   @db.Uuid
  subcategoryId          String?   @db.Uuid
  name                   String    @db.VarChar(255)
  code                   String?   @unique @db.VarChar(50)
  description            String?   @db.Text
  shortDescription       String?   @db.VarChar(500)
  duration               Int?
  durationUnit           String?   @default("days") @db.VarChar(20)
  complexity             String?   @db.VarChar(50)
  successRate            Decimal?  @db.Decimal(5, 2)
  recoveryTime           Int?
  minPrice               Decimal?  @db.Decimal(12, 2)
  maxPrice               Decimal?  @db.Decimal(12, 2)
  avgPrice               Decimal?  @db.Decimal(12, 2)
  currency               String    @default("USD") @db.VarChar(3)
  isActive               Boolean   @default(true)
  isFeatured             Boolean   @default(false)
  isPopular              Boolean   @default(false)
  displayOrder           Int       @default(0)
  images                 Json?
  videos                 Json?
  slug                   String    @unique @db.VarChar(255)
  metaTitle              String?   @db.VarChar(255)
  metaDescription        String?   @db.VarChar(500)
  metaKeywords           String?   @db.VarChar(500)
  bookingsCount          Int       @default(0)
  viewsCount             Int       @default(0)
  rating                 Decimal?  @db.Decimal(3, 2)
  reviewsCount           Int       @default(0)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  category               TreatmentCategory? @relation(fields: [categoryId], references: [categoryId], onDelete: SetNull)
  subcategory            TreatmentSubcategory? @relation(fields: [subcategoryId], references: [subcategoryId], onDelete: SetNull)
  bookings               Booking[]
  packages               Package[]
  patientTreatmentPlans  PatientTreatmentPlan[]
  
  @@index([categoryId])
  @@index([subcategoryId])
  @@index([slug])
  @@index([isActive])
  @@index([isFeatured])
  @@map("treatments")
}

model TreatmentCategory {
  categoryId             String    @id @default(uuid()) @db.Uuid
  name                   String    @unique @db.VarChar(255)
  code                   String?   @unique @db.VarChar(50)
  description            String?   @db.Text
  icon                   String?   @db.VarChar(255)
  imageUrl               String?   @db.VarChar(500)
  isActive               Boolean   @default(true)
  displayOrder           Int       @default(0)
  slug                   String    @unique @db.VarChar(255)
  metaTitle              String?   @db.VarChar(255)
  metaDescription        String?   @db.VarChar(500)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  treatments             Treatment[]
  subcategories          TreatmentSubcategory[]
  
  @@index([slug])
  @@index([isActive])
  @@map("treatment_categories")
}

model TreatmentSubcategory {
  subcategoryId          String    @id @default(uuid()) @db.Uuid
  categoryId             String    @db.Uuid
  name                   String    @db.VarChar(255)
  code                   String?   @db.VarChar(50)
  description            String?   @db.Text
  icon                   String?   @db.VarChar(255)
  imageUrl               String?   @db.VarChar(500)
  isActive               Boolean   @default(true)
  displayOrder           Int       @default(0)
  slug                   String    @unique @db.VarChar(255)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  category               TreatmentCategory @relation(fields: [categoryId], references: [categoryId], onDelete: Cascade)
  treatments             Treatment[]
  
  @@unique([categoryId, name])
  @@index([categoryId])
  @@index([slug])
  @@index([isActive])
  @@map("treatment_subcategories")
}

model User {
  userId                  String    @id @default(uuid()) @db.Uuid
  email                   String    @unique @db.VarChar(255)
  password                String    @db.VarChar(255)
  role                    String    @default("patient") @db.VarChar(50)
  firstName               String    @db.VarChar(100)
  lastName                String    @db.VarChar(100)
  phone                   String?   @db.VarChar(20)
  countryCode             String?   @db.VarChar(10)
  dateOfBirth             DateTime? @db.Date
  gender                  String?   @db.VarChar(20)
  profilePicture          String?   @db.VarChar(500)
  address                 String?   @db.Text
  city                    String?   @db.VarChar(100)
  state                   String?   @db.VarChar(100)
  country                 String?   @db.VarChar(100)
  postalCode              String?   @db.VarChar(20)
  isEmailVerified         Boolean   @default(false)
  isPhoneVerified         Boolean   @default(false)
  emailVerifiedAt         DateTime?
  phoneVerifiedAt         DateTime?
  twoFactorEnabled        Boolean   @default(false)
  twoFactorSecret         String?   @db.VarChar(255)
  isActive                Boolean   @default(true)
  isDeleted               Boolean   @default(false)
  lastLoginAt             DateTime?
  lastLoginIp             String?   @db.VarChar(45)
  loginAttempts           Int       @default(0)
  lockedUntil             DateTime?
  preferences             Json?
  metadata                Json?
  referralCode            String?   @unique @db.VarChar(50)
  referredBy              String?   @db.Uuid
  
  // OAuth Authentication Fields
  authProvider            String?   @db.VarChar(50)
  authProviderId          String?   @db.VarChar(255)
  
  // OTP Authentication Fields
  emailOtp                String?   @db.VarChar(10)
  emailOtpExpiry          DateTime?
  phoneOtp                String?   @db.VarChar(10)
  phoneOtpExpiry          DateTime?
  
  // Additional Auth Fields
  loginCount              Int       @default(0)
  accountStatus           String    @default("active") @db.VarChar(50)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  patient                 Patient?
  doctor                  Doctor?
  bookings                Booking[]
  accommodations          Accommodation[]
  appointments            Appointment[]
  consultations           Consultation[]
  familyMembers           FamilyMember[]
  reviews                 Review[]
  sessions                Session[]
  devices                 Device[]
  notifications           Notification[]
  passwordResets          PasswordReset[]
  emailConfirmations      EmailConfirmation[]
  prescriptions           Prescription[]
  payments                Payment[]
  invoices                Invoice[]
  transactions            Transaction[]
  supportTickets          SupportTicket[]
  auditLogs               AuditLog[]

  sentConversations       ChatConversation[] @relation("SenderConversations")
  receivedConversations   ChatConversation[] @relation("ReceiverConversations")
  sentMessages            ChatMessage[]      @relation("SentMessages")

  companions              Companion[]
  documents               Document[]
  emailLogs               EmailLog[]
  insurances              Insurance[]
  expertCalls             ExpertCall[]

  @@index([email])
  @@index([role])
  @@index([isActive])
  @@index([referralCode])
  @@index([authProvider])
  @@index([phone])
  @@map("users")
}

model UserAcceptance {
  acceptanceId            String    @id @default(uuid()) @db.Uuid
  userId                  String    @db.Uuid
  documentType            String    @db.VarChar(50)
  documentId              String    @db.Uuid
  documentVersion         String    @db.VarChar(50)
  acceptedAt              DateTime  @default(now())
  ipAddress               String?   @db.VarChar(45)
  userAgent               String?   @db.Text
  consentGiven            Boolean   @default(true)
  metadata                Json?
  createdAt               DateTime  @default(now())
  
  @@unique([userId, documentType, documentVersion])
  @@index([userId])
  @@index([documentType])
  @@index([acceptedAt])
  @@map("user_acceptances")
}

model VitalSign {
  vitalSignId             String    @id @default(uuid()) @db.Uuid
  patientId               String    @db.Uuid
  appointmentId           String?   @db.Uuid
  recordedBy              String?   @db.Uuid
  temperature             Decimal?  @db.Decimal(4, 1)
  temperatureUnit         String?   @default("C") @db.VarChar(1)
  bloodPressureSystolic   Int?
  bloodPressureDiastolic  Int?
  heartRate               Int?
  respiratoryRate         Int?
  oxygenSaturation        Decimal?  @db.Decimal(5, 2)
  height                  Decimal?  @db.Decimal(5, 2)
  heightUnit              String?   @default("cm") @db.VarChar(2)
  weight                  Decimal?  @db.Decimal(5, 2)
  weightUnit              String?   @default("kg") @db.VarChar(2)
  bmi                     Decimal?  @db.Decimal(5, 2)
  bloodGlucose            Decimal?  @db.Decimal(5, 2)
  painLevel               Int?
  notes                   String?   @db.Text
  recordedAt              DateTime  @default(now())
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  patient                 Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
  
  @@index([patientId])
  @@index([appointmentId])
  @@index([recordedAt])
  @@map("vital_signs")
}

model WebsiteContent {
  contentId               String    @id @default(uuid()) @db.Uuid
  key                     String    @unique @db.VarChar(255)
  title                   String    @db.VarChar(500)
  content                 String    @db.Text
  contentType             String    @db.VarChar(50)
  language                String    @default("en") @db.VarChar(10)
  section                 String?   @db.VarChar(100)
  category                String?   @db.VarChar(100)
  tags                    Json?
  metadata                Json?
  seoTitle                String?   @db.VarChar(255)
  seoDescription          String?   @db.VarChar(500)
  seoKeywords             String?   @db.VarChar(500)
  slug                    String?   @unique @db.VarChar(255)
  imageUrl                String?   @db.VarChar(500)
  videoUrl                String?   @db.VarChar(500)
  isPublished             Boolean   @default(false)
  publishedAt             DateTime?
  publishedBy             String?   @db.Uuid
  displayOrder            Int       @default(0)
  viewCount               Int       @default(0)
  lastViewedAt            DateTime?
  createdBy               String?   @db.Uuid
  updatedBy               String?   @db.Uuid
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@index([key])
  @@index([contentType])
  @@index([section])
  @@index([isPublished])
  @@map("website_contents")
}

model Wishlist {
  wishlistId              String    @id @default(uuid()) @db.Uuid
  userId                  String    @db.Uuid
  entityType              String    @db.VarChar(50)
  entityId                String    @db.Uuid
  notes                   String?   @db.Text
  priority                Int       @default(0)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@unique([userId, entityType, entityId])
  @@index([userId])
  @@index([entityType, entityId])
  @@map("wishlists")
}

