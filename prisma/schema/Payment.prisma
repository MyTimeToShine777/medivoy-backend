// Payment Model - Payment transactions for bookings
// NO optional chaining - Production Ready
model Payment {
  // ========== PRIMARY KEY ==========
  id                      Int       @id @default(autoincrement())
  
  // ========== FOREIGN KEYS ==========
  bookingId               String    @db.Uuid
  patientId               String    @db.Uuid
  
  // ========== PAYMENT DETAILS ==========
  amount                  Decimal   @db.Decimal(12, 2)
  currency                String    @default("INR") @db.VarChar(3)
  gateway                 String    @db.VarChar(50)     // razorpay, stripe, paypal
  transactionId           String    @unique @db.VarChar(255)
  
  // ========== STATUS ==========
  paymentStatus           String    @default("pending") @db.VarChar(50)  // pending, completed, failed, refunded
  paymentMethod           String?   @db.VarChar(50)     // card, upi, netbanking, wallet
  
  // ========== PAYMENT DATA ==========
  paymentDetails          Json?     // Gateway response, card details (masked), etc
  receiptUrl              String?   @db.VarChar(500)
  errorMessage            String?   @db.Text
  
  // ========== TIMESTAMPS ==========
  completedAt             DateTime?
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")
  
  // ========== RELATIONSHIPS ==========
  booking                 Booking   @relation(fields: [bookingId], references: [bookingId], onDelete: Cascade)
  user                    User      @relation(fields: [patientId], references: [userId], onDelete: Cascade)
  invoices                Invoice[]
  accommodations          Accommodation[]
  appointments            Appointment[]
  
  // ========== INDEXES ==========
  @@index([bookingId])
  @@index([patientId])
  @@index([paymentStatus])
  
  // ========== TABLE MAPPING ==========
  @@map("payments")
}
