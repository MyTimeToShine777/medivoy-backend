{'role': 'assistant', 'content': 'Let\'s fix the patient.controller.js file:\n\n<function_calls>\n<full-file-rewrite file_path="src/controllers/patient.controller.js">\nconst Patient = require(\'../models/Patient.model\');\nconst { successResponse, errorResponse } = require(\'../utils/response\');\nconst logger = require(\'../utils/logger\');\n\nclass PatientController {\n  /**\n   * Create a new patient\n   */\n  async createPatient(req, res) {\n    try {\n      const { userId, dateOfBirth, gender, bloodType, emergencyContact, medicalHistory, allergies, insuranceId } = req.body;\n      \n      // Create patient\n      const patient = await Patient.create({\n        userId,\n        dateOfBirth,\n        gender,\n        bloodType,\n        emergencyContact,\n        medicalHistory,\n        allergies,\n        insuranceId,\n      });\n      \n      return successResponse(res, {\n        message: \'Patient created successfully\',\n        data: patient,\n      }, 201);\n    } catch (error) {\n      logger.error(\'Create patient error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to create patient\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get patient by ID\n   */\n  async getPatient(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find patient\n      const patient = await Patient.findByPk(id);\n      \n      if (!patient) {\n        return errorResponse(res, {\n          message: \'Patient not found\',\n        }, 404);\n      }\n      \n      return successResponse(res, {\n        message: \'Patient retrieved successfully\',\n        data: patient,\n      });\n    } catch (error) {\n      logger.error(\'Get patient error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve patient\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Update patient\n   */\n  async updatePatient(req, res) {\n    try {\n      const { id } = req.params;\n      const { dateOfBirth, gender, bloodType, emergencyContact, medicalHistory, allergies, insuranceId } = req.body;\n      \n      // Find patient\n      const patient = await Patient.findByPk(id);\n      \n      if (!patient) {\n        return errorResponse(res, {\n          message: \'Patient not found\',\n        }, 404);\n      }\n      \n      // Update patient\n      await patient.update({\n        dateOfBirth,\n        gender,\n        bloodType,\n        emergencyContact,\n        medicalHistory,\n        allergies,\n        insuranceId,\n      });\n      \n      return successResponse(res, {\n        message: \'Patient updated successfully\',\n        data: patient,\n      });\n    } catch (error) {\n      logger.error(\'Update patient error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to update patient\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Delete patient\n   */\n  async deletePatient(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find patient\n      const patient = await Patient.findByPk(id);\n      \n      if (!patient) {\n        return errorResponse(res, {\n          message: \'Patient not found\',\n        }, 404);\n      }\n      \n      // Delete patient\n      await patient.destroy();\n      \n      return successResponse(res, {\n        message: \'Patient deleted successfully\',\n      });\n    } catch (error) {\n      logger.error(\'Delete patient error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to delete patient\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get all patients\n   */\n  async getAllPatients(req, res) {\n    try {\n      const { page = 1, limit = 10 } = req.query;\n      \n      // Get patients with pagination\n      const patients = await Patient.findAndCountAll({\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'createdAt\', \'DESC\']],\n      });\n      \n      return successResponse(res, {\n        message: \'Patients retrieved successfully\',\n        data: patients.rows,\n        pagination: {\n          currentPage: parseInt(page, 10),\n          totalPages: Math.ceil(patients.count / parseInt(limit, 10)),\n          totalRecords: patients.count,\n        },\n      });\n    } catch (error) {\n      logger.error(\'Get all patients error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve patients\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get patient medical records\n   */\n  async getMedicalRecords(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find patient\n      const patient = await Patient.findByPk(id);\n      \n      if (!patient) {\n        return errorResponse(res, {\n          message: \'Patient not found\',\n        }, 404);\n      }\n      \n      // Get patient medical records\n      // Note: This would require importing the MedicalRecord model\n      // const medicalRecords = await MedicalRecord.findAll({\n      //   where: { patientId: id },\n      //   order: [[\'recordDate\', \'DESC\']],\n      // });\n      \n      return successResponse(res, {\n        message: \'Patient medical records retrieved successfully\',\n        data: [],\n      });\n    } catch (error) {\n      logger.error(\'Get patient medical records error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve patient medical records\',\n        error: error.message,\n      }, 500);\n    }\n  }\n}\n\nmodule.exports = new PatientController();\n</full-file-rewrite>\n</function_calls>'}