{'role': 'assistant', 'content': 'Let\'s fix the upload.controller.js file:\n\n<function_calls>\n<full-file-rewrite file_path="src/controllers/upload.controller.js">\nconst Media = require(\'../models/Media.model\');\nconst { successResponse, errorResponse } = require(\'../utils/response\');\nconst logger = require(\'../utils/logger\');\n\nclass UploadController {\n  /**\n   * Upload a file\n   */\n  async uploadFile(req, res) {\n    try {\n      // Check if file was uploaded\n      if (!req.file) {\n        return errorResponse(res, {\n          message: \'No file uploaded\',\n        }, 400);\n      }\n      \n      const { originalname, mimetype, size, filename, path } = req.file;\n      const { entityType, entityId } = req.body;\n      \n      // Create media record\n      const media = await Media.create({\n        fileName: originalname,\n        fileType: mimetype,\n        fileSize: size,\n        filePath: path,\n        entity_type: entityType,\n        entity_id: entityId,\n      });\n      \n      return successResponse(res, {\n        message: \'File uploaded successfully\',\n        data: media,\n      }, 201);\n    } catch (error) {\n      logger.error(\'Upload file error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to upload file\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get media by ID\n   */\n  async getMedia(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find media\n      const media = await Media.findByPk(id);\n      \n      if (!media) {\n        return errorResponse(res, {\n          message: \'Media not found\',\n        }, 404);\n      }\n      \n      return successResponse(res, {\n        message: \'Media retrieved successfully\',\n        data: media,\n      });\n    } catch (error) {\n      logger.error(\'Get media error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve media\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Update media\n   */\n  async updateMedia(req, res) {\n    try {\n      const { id } = req.params;\n      const { fileName, entityType, entityId } = req.body;\n      \n      // Find media\n      const media = await Media.findByPk(id);\n      \n      if (!media) {\n        return errorResponse(res, {\n          message: \'Media not found\',\n        }, 404);\n      }\n      \n      // Update media\n      await media.update({\n        fileName,\n        entity_type: entityType,\n        entity_id: entityId,\n      });\n      \n      return successResponse(res, {\n        message: \'Media updated successfully\',\n        data: media,\n      });\n    } catch (error) {\n      logger.error(\'Update media error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to update media\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Delete media\n   */\n  async deleteMedia(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find media\n      const media = await Media.findByPk(id);\n      \n      if (!media) {\n        return errorResponse(res, {\n          message: \'Media not found\',\n        }, 404);\n      }\n      \n      // Delete media file from storage\n      // Note: This would require integrating with Cloudinary or file system\n      // await deleteFile(media.filePath);\n      \n      // Delete media record\n      await media.destroy();\n      \n      return successResponse(res, {\n        message: \'Media deleted successfully\',\n      });\n    } catch (error) {\n      logger.error(\'Delete media error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to delete media\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get all media for an entity\n   */\n  async getEntityMedia(req, res) {\n    try {\n      const { entityType, entityId } = req.params;\n      const { page = 1, limit = 10 } = req.query;\n      \n      // Get media with pagination\n      const media = await Media.findAndCountAll({\n        where: {\n          entity_type: entityType,\n          entity_id: entityId,\n        },\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'createdAt\', \'DESC\']],\n      })...\n The full message content is stored at /workspace/summarized_conversations/original_conversation_1761713126_5093.txt'}