{'role': 'assistant', 'content': 'Let\'s fix the treatment.controller.js file:\n\n<function_calls>\n<full-file-rewrite file_path="src/controllers/treatment.controller.js">\nconst Treatment = require(\'../models/Treatment.model\');\nconst TreatmentCategory = require(\'../models/TreatmentCategory.model\');\nconst TreatmentSubcategory = require(\'../models/TreatmentSubcategory.model\');\nconst { successResponse, errorResponse } = require(\'../utils/response\');\nconst logger = require(\'../utils/logger\');\n\nclass TreatmentController {\n  /**\n   * Create a new treatment\n   */\n  async createTreatment(req, res) {\n    try {\n      const { name, description, categoryId, subcategoryId, price, duration, isActive } = req.body;\n      \n      // Create treatment\n      const treatment = await Treatment.create({\n        name,\n        description,\n        categoryId,\n        subcategoryId,\n        price,\n        duration,\n        isActive,\n      });\n      \n      return successResponse(res, {\n        message: \'Treatment created successfully\',\n        data: treatment,\n      }, 201);\n    } catch (error) {\n      logger.error(\'Create treatment error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to create treatment\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get treatment by ID\n   */\n  async getTreatment(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find treatment with associated category and subcategory\n      const treatment = await Treatment.findByPk(id, {\n        include: [\n          {\n            model: TreatmentCategory,\n            as: \'category\',\n            attributes: [\'id\', \'name\', \'slug\'],\n          },\n          {\n            model: TreatmentSubcategory,\n            as: \'subcategory\',\n            attributes: [\'id\', \'name\', \'slug\'],\n          },\n        ],\n      });\n      \n      if (!treatment) {\n        return errorResponse(res, {\n          message: \'Treatment not found\',\n        }, 404);\n      }\n      \n      return successResponse(res, {\n        message: \'Treatment retrieved successfully\',\n        data: treatment,\n      });\n    } catch (error) {\n      logger.error(\'Get treatment error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve treatment\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Update treatment\n   */\n  async updateTreatment(req, res) {\n    try {\n      const { id } = req.params;\n      const { name, description, categoryId, subcategoryId, price, duration, isActive } = req.body;\n      \n      // Find treatment\n      const treatment = await Treatment.findByPk(id);\n      \n      if (!treatment) {\n        return errorResponse(res, {\n          message: \'Treatment not found\',\n        }, 404);\n      }\n      \n      // Update treatment\n      await treatment.update({\n        name,\n        description,\n        categoryId,\n        subcategoryId,\n        price,\n        duration,\n        isActive,\n      });\n      \n      return successResponse(res, {\n        message: \'Treatment updated successfully\',\n        data: treatment,\n      });\n    } catch (error) {\n      logger.error(\'Update treatment error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to update treatment\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Delete treatment\n   */\n  async deleteTreatment(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find treatment\n      const treatment = await Treatment.findByPk(id);\n      \n      if (!treatment) {\n        return errorResponse(res, {\n          message: \'Treatment not found\',\n        }, 404);\n      }\n      \n      // Delete treatment\n      await treatment.destroy();\n      \n      return successResponse(res, {\n        message: \'Treatment deleted successfully\',\n      });\n    } catch (error) {\n      logger.error(\'Delete treatment error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to delete treatment\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get all treatments\n   */\n  async getAllTreatments(req, res) {\n    try {\n      const { page = 1, limit = 10, categoryId, subcategoryId, isActive, search } = req.query;\n      \n      // Build where clause\n      const where = {};\n      if (categoryId) where.categoryId = categoryId;\n      if (subcategoryId) where.subcategoryId = subcategoryId;\n      if (isActive !== undefined) where.isActive = isActive === \'true\';\n      if (search) where.name = { [Sequelize.Op.iLike]: `%${search}%` };\n      \n      // Get treatments with pagination and associated category/subcategory\n      const treatments = await Treatment.findAndCountAll({\n        where,\n        include: [\n          {\n            model: TreatmentCategory,\n            as: \'category\',\n            attributes: [\'id\', \'name\', \'slug\'],\n          },\n          {\n            model: TreatmentSubcategory,\n            as: \'subcategory\',\n            attributes: [\'id\', \'name\', \'slug\'],\n          },\n        ],\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'name\', \'ASC\']],\n      });\n      \n      return successResponse(res, {\n        message: \'Treatments retrieved successfully\',\n        data: treatments.rows,\n        pagination: {\n          currentPage: parseInt(page, 10),\n          totalPages: Math.ceil(treatments.count / parseInt(limit, 10)),\n          totalRecords: treatments.count,\n        },\n      });\n    } catch (error) {\n      logger.error(\'Get all treatments error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve treatments\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get treatments by category\n   */\n  async getTreatmentsByCategory(req, res) {\n    try {\n      const { categoryId } = req.params;\n      const { page = 1, limit = 10, isActive } = req.query;\n      \n      // Build where clause\n      const where = { categoryId };\n      if (isActive !== undefined) where.isActive = isActive === \'true\';\n      \n      // Get treatments with pagination\n      const treatments = await Treatment.findAndCountAll({\n        where,\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'name\', \'ASC\']],\n      });\n      \n      return successResponse(res, {\n        message: \'Treatments retrieved successfully\',\n        data: treatments.rows,\n        pagination: {\n          currentPage: parseInt(page, 10),\n          totalPages: Math.ceil(treatments.count / parseInt(limit, 10)),\n          totalRecords: treatments.count,\n        },\n      });\n    } catch (error) {\n      logger.error(\'Get treatments by category error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve treatments\',\n        error: error.message,\n      }, 500);\n    }\n  }\n}\n\nmodule.exports = new TreatmentController();\n</full-file-rewrite>\n</function_calls>'}