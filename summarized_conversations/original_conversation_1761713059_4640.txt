{'role': 'assistant', 'content': 'Let\'s start by fixing the auth.controller.js file since it\'s one of the most important controllers:\n\n<function_calls>\n<full-file-rewrite file_path="src/controllers/auth.controller.js">\nconst bcrypt = require(\'bcrypt\');\nconst jwt = require(\'jsonwebtoken\');\nconst { validationResult } = require(\'express-validator\');\nconst User = require(\'../models/User.model\');\nconst Patient = require(\'../models/Patient.model\');\nconst Doctor = require(\'../models/Doctor.model\');\nconst Hospital = require(\'../models/Hospital.model\');\nconst {\n  generateAccessToken,\n  generateRefreshToken,\n} = require(\'../utils/jwt\');\nconst config = require(\'../config\');\nconst logger = require(\'../utils/logger\');\nconst { sendWelcomeEmail } = require(\'../services/email.service\');\nconst RefreshToken = require(\'../models/RefreshToken.model\');\nconst {\n  successResponse,\n  errorResponse,\n} = require(\'../utils/response\');\n\nclass AuthController {\n  /**\n   * Register a new user\n   */\n  async register(req, res) {\n    try {\n      // Check for validation errors\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return errorResponse(res, {\n          message: \'Validation failed\',\n          errors: errors.array(),\n        }, 400);\n      }\n\n      const {\n        email,\n        password,\n        firstName,\n        lastName,\n        role,\n        phone,\n      } = req.body;\n\n      // Check if user already exists\n      const existingUser = await User.findOne({ where: { email } });\n      if (existingUser) {\n        return errorResponse(res, {\n          message: \'User with this email already exists\',\n          code: \'USER_EMAIL_EXISTS\',\n        }, 409);\n      }\n\n      // Hash password\n      const saltRounds = config.bcryptSaltRounds;\n      const hashedPassword = await bcrypt.hash(password, saltRounds);\n\n      // Create user\n      const user = await User.create({\n        email,\n        password: hashedPassword,\n        firstName,\n        lastName,\n        role,\n        phone,\n      });\n\n      // Create role-specific profile\n      if (role === \'patient\') {\n        await Patient.create({\n          userId: user.id,\n          dateOfBirth: null,\n          gender: null,\n          bloodType: null,\n          emergencyContact: null,\n        });\n      } else if (role === \'doctor\') {\n        await Doctor.create({\n          userId: user.id,\n          specialty: null,\n          licenseNumber: null,\n          yearsOfExperience: null,\n        });\n      } else if (role === \'hospital_admin\') {\n        await Hospital.create({\n          userId: user.id,\n          name: null,\n          address: null,\n          phone: null,\n          licenseNumber: null,\n        });\n      }\n\n      // Generate tokens\n      const accessToken = generateAccessToken(user);\n      const refreshToken = generateRefreshToken(user);\n\n      // Save refresh token\n      await RefreshToken.create({\n        token: refreshToken,\n        userId: user.id,\n      });\n\n      // Send welcome email\n      await sendWelcomeEmail(user.email, user.firstName);\n\n      // Return success response\n      return successResponse(res, {\n        message: \'User registered successfully\',\n        data: {\n          user: {\n            id: user.id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            role: user.role,\n          },\n          accessToken,\n          refreshToken,\n        },\n      }, 201);\n    } catch (error) {\n      logger.error(\'Registration error:\', error);\n      return errorResponse(res, {\n        message: \'Registration failed\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Login user\n   */\n  async login(req, res) {\n    try {\n      // Check for validation errors\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return errorResponse(res, {\n          message: \'Validation failed\',\n          errors: errors.array(),\n        }, 400);\n      }\n\n      const { email, password } = req.body;\n\n      // Find user\n      const user = await User.findOne({ where: { email } });\n      if (!user) {\n        return error...\n The full message content is stored at /workspace/summarized_conversations/original_conversation_1761713011_514.txt'}