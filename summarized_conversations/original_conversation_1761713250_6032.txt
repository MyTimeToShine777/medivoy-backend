{'role': 'assistant', 'content': 'Let\'s fix the coupon.controller.js file:\n\n<function_calls>\n<full-file-rewrite file_path="src/controllers/coupon.controller.js">\nconst Coupon = require(\'../models/Coupon.model\');\nconst { successResponse, errorResponse } = require(\'../utils/response\');\nconst logger = require(\'../utils/logger\');\n\nclass CouponController {\n  /**\n   * Create a new coupon\n   */\n  async createCoupon(req, res) {\n    try {\n      const { code, discountType, discountValue, validFrom, validUntil, maxUses, usedCount } = req.body;\n      \n      // Create coupon\n      const coupon = await Coupon.create({\n        code,\n        discountType,\n        discountValue,\n        validFrom,\n        validUntil,\n        maxUses,\n        usedCount,\n      });\n      \n      return successResponse(res, {\n        message: \'Coupon created successfully\',\n        data: coupon,\n      }, 201);\n    } catch (error) {\n      logger.error(\'Create coupon error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to create coupon\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get coupon by ID\n   */\n  async getCoupon(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find coupon\n      const coupon = await Coupon.findByPk(id);\n      \n      if (!coupon) {\n        return errorResponse(res, {\n          message: \'Coupon not found\',\n        }, 404);\n      }\n      \n      return successResponse(res, {\n        message: \'Coupon retrieved successfully\',\n        data: coupon,\n      });\n    } catch (error) {\n      logger.error(\'Get coupon error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve coupon\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get all coupons\n   */\n  async getAllCoupons(req, res) {\n    try {\n      const { page = 1, limit = 10 } = req.query;\n      \n      // Get coupons with pagination\n      const coupons = await Coupon.findAndCountAll({\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'createdAt\', \'DESC\']],\n      });\n      \n      return successResponse(res, {\n        message: \'Coupons retrieved successfully\',\n        data: coupons.rows,\n        pagination: {\n          currentPage: parseInt(page, 10),\n          totalPages: Math.ceil(coupons.count / parseInt(limit, 10)),\n          totalRecords: coupons.count,\n        },\n      });\n    } catch (error) {\n      logger.error(\'Get all coupons error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve coupons\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Validate coupon\n   */\n  async validateCoupon(req, res) {\n    try {\n      const { code } = req.params;\n      \n      // Find coupon by code\n      const coupon = await Coupon.findOne({ where: { code } });\n      \n      if (!coupon) {\n        return errorResponse(res, {\n          message: \'Coupon not found\',\n        }, 404);\n      }\n      \n      // Check if coupon is valid\n      const now = new Date();\n      if (new Date(coupon.validFrom) > now) {\n        return errorResponse(res, {\n          message: \'Coupon is not yet valid\',\n        }, 400);\n      }\n      \n      if (new Date(coupon.validUntil) < now) {\n        return errorResponse(res, {\n          message: \'Coupon has expired\',\n        }, 400);\n      }\n      \n      if (coupon.maxUses > 0 && coupon.usedCount >= coupon.maxUses) {\n        return errorResponse(res, {\n          message: \'Coupon has reached maximum uses\',\n        }, 400);\n      }\n      \n      return successResponse(res, {\n        message: \'Coupon is valid\',\n        data: coupon,\n      });\n    } catch (error) {\n      logger.error(\'Validate coupon error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to validate coupon\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Apply coupon\n   */\n  async applyCoupon(req, res) {\n    try {\n      const { code } = req.params;\n      \n      // Find coupon by code\n      const coupon = await Coupon.findOne({ where: { code } });\n      \n      if (!coupon) {\n        return errorResp...\n The full message content is stored at /workspace/summarized_conversations/original_conversation_1761713204_7822.txt'}