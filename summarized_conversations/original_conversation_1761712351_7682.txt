{'role': 'assistant', 'content': 'Let\'s fix the payment.controller.js file:\n\n<function_calls>\n<full-file-rewrite file_path="src/controllers/payment.controller.js">\nconst Payment = require(\'../models/Payment.model\');\nconst { successResponse, errorResponse } = require(\'../utils/response\');\nconst logger = require(\'../utils/logger\');\n\nclass PaymentController {\n  /**\n   * Create a new payment\n   */\n  async createPayment(req, res) {\n    try {\n      const { bookingId, patientId, amount, currency, paymentMethod, transactionId } = req.body;\n      \n      // Create payment\n      const payment = await Payment.create({\n        bookingId,\n        patientId,\n        amount,\n        currency,\n        paymentMethod,\n        transactionId,\n      });\n      \n      return successResponse(res, {\n        message: \'Payment created successfully\',\n        data: payment,\n      }, 201);\n    } catch (error) {\n      logger.error(\'Create payment error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to create payment\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get payment by ID\n   */\n  async getPayment(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find payment\n      const payment = await Payment.findByPk(id);\n      \n      if (!payment) {\n        return errorResponse(res, {\n          message: \'Payment not found\',\n        }, 404);\n      }\n      \n      return successResponse(res, {\n        message: \'Payment retrieved successfully\',\n        data: payment,\n      });\n    } catch (error) {\n      logger.error(\'Get payment error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve payment\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Update payment\n   */\n  async updatePayment(req, res) {\n    try {\n      const { id } = req.params;\n      const { status, transactionId } = req.body;\n      \n      // Find payment\n      const payment = await Payment.findByPk(id);\n      \n      if (!payment) {\n        return errorResponse(res, {\n          message: \'Payment not found\',\n        }, 404);\n      }\n      \n      // Update payment\n      await payment.update({\n        status,\n        transactionId,\n      });\n      \n      return successResponse(res, {\n        message: \'Payment updated successfully\',\n        data: payment,\n      });\n    } catch (error) {\n      logger.error(\'Update payment error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to update payment\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Delete payment\n   */\n  async deletePayment(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find payment\n      const payment = await Payment.findByPk(id);\n      \n      if (!payment) {\n        return errorResponse(res, {\n          message: \'Payment not found\',\n        }, 404);\n      }\n      \n      // Delete payment\n      await payment.destroy();\n      \n      return successResponse(res, {\n        message: \'Payment deleted successfully\',\n      });\n    } catch (error) {\n      logger.error(\'Delete payment error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to delete payment\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get all payments\n   */\n  async getAllPayments(req, res) {\n    try {\n      const { page = 1, limit = 10, status, patientId } = req.query;\n      \n      // Build where clause\n      const where = {};\n      if (status) where.status = status;\n      if (patientId) where.patientId = patientId;\n      \n      // Get payments with pagination\n      const payments = await Payment.findAndCountAll({\n        where,\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'createdAt\', \'DESC\']],\n      });\n      \n      return successResponse(res, {\n        message: \'Payments retrieved successfully\',\n        data: payments.rows,\n        pagination: {\n          currentPage: parseInt(page, 10),\n          totalPages: Math.ceil(payments.count / parseInt(limit, 10)),\n          totalRecords: payments.count,\n        },\n      });\n    } catch (error) {\n      logger.error(\'Get all payments error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve payments\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Process payment refund\n   */\n  async processRefund(req, res) {\n    try {\n      const { id } = req.params;\n      const { refundAmount, refundReason } = req.body;\n      \n      // Find payment\n      const payment = await Payment.findByPk(id);\n      \n      if (!payment) {\n        return errorResponse(res, {\n          message: \'Payment not found\',\n        }, 404);\n      }\n      \n      // Process refund\n      // Note: This would integrate with Stripe/Razorpay APIs\n      const refundTransactionId = `refund_${Date.now()}`; // Placeholder\n      \n      // Update payment with refund details\n      await payment.update({\n        refundAmount,\n        refundReason,\n        refundTransactionId,\n        status: \'refunded\',\n      });\n      \n      return successResponse(res, {\n        message: \'Payment refund processed successfully\',\n        data: payment,\n      });\n    } catch (error) {\n      logger.error(\'Process payment refund error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to process payment refund\',\n        error: error.message,\n      }, 500);\n    }\n  }\n}\n\nmodule.exports = new PaymentController();\n</full-file-rewrite>\n</function_calls>'}