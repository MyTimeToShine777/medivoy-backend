{'role': 'assistant', 'content': 'Let\'s fix the prescription.controller.js file:\n\n<function_calls>\n<full-file-rewrite file_path="src/controllers/prescription.controller.js">\nconst Prescription = require(\'../models/Prescription.model\');\nconst { successResponse, errorResponse } = require(\'../utils/response\');\nconst logger = require(\'../utils/logger\');\n\nclass PrescriptionController {\n  /**\n   * Create a new prescription\n   */\n  async createPrescription(req, res) {\n    try {\n      const { appointmentId, doctorId, patientId, medications, dosage, duration, notes } = req.body;\n      \n      // Create prescription\n      const prescription = await Prescription.create({\n        appointmentId,\n        doctorId,\n        patientId,\n        medications,\n        dosage,\n        duration,\n        notes,\n      });\n      \n      return successResponse(res, {\n        message: \'Prescription created successfully\',\n        data: prescription,\n      }, 201);\n    } catch (error) {\n      logger.error(\'Create prescription error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to create prescription\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get prescription by ID\n   */\n  async getPrescription(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find prescription\n      const prescription = await Prescription.findByPk(id);\n      \n      if (!prescription) {\n        return errorResponse(res, {\n          message: \'Prescription not found\',\n        }, 404);\n      }\n      \n      return successResponse(res, {\n        message: \'Prescription retrieved successfully\',\n        data: prescription,\n      });\n    } catch (error) {\n      logger.error(\'Get prescription error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve prescription\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Update prescription\n   */\n  async updatePrescription(req, res) {\n    try {\n      const { id } = req.params;\n      const { medications, dosage, duration, notes, isFulfilled } = req.body;\n      \n      // Find prescription\n      const prescription = await Prescription.findByPk(id);\n      \n      if (!prescription) {\n        return errorResponse(res, {\n          message: \'Prescription not found\',\n        }, 404);\n      }\n      \n      // Update prescription\n      await prescription.update({\n        medications,\n        dosage,\n        duration,\n        notes,\n        isFulfilled,\n      });\n      \n      return successResponse(res, {\n        message: \'Prescription updated successfully\',\n        data: prescription,\n      });\n    } catch (error) {\n      logger.error(\'Update prescription error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to update prescription\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Delete prescription\n   */\n  async deletePrescription(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find prescription\n      const prescription = await Prescription.findByPk(id);\n      \n      if (!prescription) {\n        return errorResponse(res, {\n          message: \'Prescription not found\',\n        }, 404);\n      }\n      \n      // Delete prescription\n      await prescription.destroy();\n      \n      return successResponse(res, {\n        message: \'Prescription deleted successfully\',\n      });\n    } catch (error) {\n      logger.error(\'Delete prescription error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to delete prescription\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get all prescriptions for a patient\n   */\n  async getPatientPrescriptions(req, res) {\n    try {\n      const { patientId } = req.params;\n      const { page = 1, limit = 10, isFulfilled } = req.query;\n      \n      // Build where clause\n      const where = { patientId };\n      if (isFulfilled !== undefined) where.isFulfilled = isFulfilled === \'true\';\n      \n      // Get prescriptions with pagination\n      const prescriptions = await Prescription.findAndCountAll({\n        where,\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'createdAt\', \'DESC\']],\n      });\n      \n      return successResponse(res, {\n        message: \'Prescriptions retrieved successfully\',\n        data: prescriptions.rows,\n        pagination: {\n          currentPage: parseInt(page, 10),\n          totalPages: Math.ceil(prescriptions.count / parseInt(limit, 10)),\n          totalRecords: prescriptions.count,\n        },\n      });\n    } catch (error) {\n      logger.error(\'Get patient prescriptions error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve prescriptions\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Generate prescription PDF\n   */\n  async generatePrescriptionPDF(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find prescription\n      const prescription = await Prescription.findByPk(id);\n      \n      if (!prescription) {\n        return errorResponse(res, {\n          message: \'Prescription not found\',\n        }, 404);\n      }\n      \n      // Generate PDF\n      // Note: This would require integrating with PDF generation service\n      const pdfUrl = `https://example.com/prescriptions/${id}.pdf`; // Placeholder\n      \n      // Update prescription with PDF URL\n      await prescription.update({ pdfUrl });\n      \n      return successResponse(res, {\n        message: \'Prescription PDF generated successfully\',\n        data: { pdfUrl },\n      });\n    } catch (error) {\n      logger.error(\'Generate prescription PDF error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to generate prescription PDF\',\n        error: error.message,\n      }, 500);\n    }\n  }\n}\n\nmodule.exports = new PrescriptionController();\n</full-file-rewrite>\n</function_calls>'}