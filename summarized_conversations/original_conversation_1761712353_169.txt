{'role': 'assistant', 'content': 'Let\'s fix the subscription.controller.js file:\n\n<function_calls>\n<full-file-rewrite file_path="src/controllers/subscription.controller.js">\nconst Subscription = require(\'../models/Subscription.model\');\nconst SubscriptionPlan = require(\'../models/SubscriptionPlan.model\');\nconst { successResponse, errorResponse } = require(\'../utils/response\');\nconst logger = require(\'../utils/logger\');\n\nclass SubscriptionController {\n  /**\n   * Create a new subscription\n   */\n  async createSubscription(req, res) {\n    try {\n      const { userId, planId, startDate, endDate, isActive } = req.body;\n      \n      // Find subscription plan\n      const plan = await SubscriptionPlan.findByPk(planId);\n      if (!plan) {\n        return errorResponse(res, {\n          message: \'Subscription plan not found\',\n        }, 404);\n      }\n      \n      // Create subscription\n      const subscription = await Subscription.create({\n        userId,\n        planId,\n        startDate,\n        endDate,\n        isActive,\n        planName: plan.name,\n        planPrice: plan.price,\n        planFeatures: plan.features,\n      });\n      \n      return successResponse(res, {\n        message: \'Subscription created successfully\',\n        data: subscription,\n      }, 201);\n    } catch (error) {\n      logger.error(\'Create subscription error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to create subscription\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get subscription by ID\n   */\n  async getSubscription(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find subscription\n      const subscription = await Subscription.findByPk(id);\n      \n      if (!subscription) {\n        return errorResponse(res, {\n          message: \'Subscription not found\',\n        }, 404);\n      }\n      \n      return successResponse(res, {\n        message: \'Subscription retrieved successfully\',\n        data: subscription,\n      });\n    } catch (error) {\n      logger.error(\'Get subscription error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve subscription\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Update subscription\n   */\n  async updateSubscription(req, res) {\n    try {\n      const { id } = req.params;\n      const { isActive, endDate } = req.body;\n      \n      // Find subscription\n      const subscription = await Subscription.findByPk(id);\n      \n      if (!subscription) {\n        return errorResponse(res, {\n          message: \'Subscription not found\',\n        }, 404);\n      }\n      \n      // Update subscription\n      await subscription.update({\n        isActive,\n        endDate,\n      });\n      \n      return successResponse(res, {\n        message: \'Subscription updated successfully\',\n        data: subscription,\n      });\n    } catch (error) {\n      logger.error(\'Update subscription error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to update subscription\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Cancel subscription\n   */\n  async cancelSubscription(req, res) {\n    try {\n      const { id } = req.params;\n      \n      // Find subscription\n      const subscription = await Subscription.findByPk(id);\n      \n      if (!subscription) {\n        return errorResponse(res, {\n          message: \'Subscription not found\',\n        }, 404);\n      }\n      \n      // Cancel subscription\n      await subscription.update({\n        isActive: false,\n        cancelledAt: new Date(),\n      });\n      \n      return successResponse(res, {\n        message: \'Subscription cancelled successfully\',\n        data: subscription,\n      });\n    } catch (error) {\n      logger.error(\'Cancel subscription error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to cancel subscription\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get all subscriptions for a user\n   */\n  async getUserSubscriptions(req, res) {\n    try {\n      const { userId } = req.params;\n      const { page = 1, limit = 10, isActive } = req.query;\n      \n      // Build where clause\n      const where = { userId };\n      if (isActive !== undefined) where.isActive = isActive === \'true\';\n      \n      // Get subscriptions with pagination\n      const subscriptions = await Subscription.findAndCountAll({\n        where,\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'createdAt\', \'DESC\']],\n      });\n      \n      return successResponse(res, {\n        message: \'Subscriptions retrieved successfully\',\n        data: subscriptions.rows,\n        pagination: {\n          currentPage: parseInt(page, 10),\n          totalPages: Math.ceil(subscriptions.count / parseInt(limit, 10)),\n          totalRecords: subscriptions.count,\n        },\n      });\n    } catch (error) {\n      logger.error(\'Get user subscriptions error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve subscriptions\',\n        error: error.message,\n      }, 500);\n    }\n  }\n\n  /**\n   * Get all subscription plans\n   */\n  async getSubscriptionPlans(req, res) {\n    try {\n      const { page = 1, limit = 10, isActive } = req.query;\n      \n      // Build where clause\n      const where = {};\n      if (isActive !== undefined) where.isActive = isActive === \'true\';\n      \n      // Get subscription plans with pagination\n      const plans = await SubscriptionPlan.findAndCountAll({\n        where,\n        limit: parseInt(limit, 10),\n        offset: (parseInt(page, 10) - 1) * parseInt(limit, 10),\n        order: [[\'createdAt\', \'DESC\']],\n      });\n      \n      return successResponse(res, {\n        message: \'Subscription plans retrieved successfully\',\n        data: plans.rows,\n        pagination: {\n          currentPage: parseInt(page, 10),\n          totalPages: Math.ceil(plans.count / parseInt(limit, 10)),\n          totalRecords: plans.count,\n        },\n      });\n    } catch (error) {\n      logger.error(\'Get subscription plans error:\', error);\n      return errorResponse(res, {\n        message: \'Failed to retrieve subscription plans\',\n        error: error.message,\n      }, 500);\n    }\n  }\n}\n\nmodule.exports = new SubscriptionController();\n</full-file-rewrite>\n</function_calls>'}